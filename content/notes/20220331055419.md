+++
title = "ğŸ“Clojure Exception: ä¾‹å¤–"
tags = ["WIKI"]
draft = false
+++

Clojureã«ãŠã‘ã‚‹ä¾‹å¤–å‡¦ç†ã‚„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã¤ã„ã¦ã¾ã¨ã‚.

-   up: [ğŸ“‚Clojure Core Languages]({{< relref "20220112142936.md" >}})
-   refs.
    -   [ğŸ”–Exceptions]({{< relref "20220305075933.md#5c863837-2d4a-457c-9566-ed1748d49e38" >}})
    -   [ğŸ“Java Exception: ä¾‹å¤–]({{< relref "20220731122944.md" >}})


## Clojure-Java Exception Interop {#afb4936b-9d05-4e5f-bfc7-5071962c34d4}

Javaã®ä»•çµ„ã¿ã‚’ä½¿ã†. ã—ãŸãŒã£ã¦Javaã®çŸ¥è­˜ãŒã‚ã‚‹ã¨better.

-   Javaã®ã‚ˆã†ã«try/catch/finallyãŒåˆ©ç”¨ã§ãã‚‹.
-   throwã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã§ä¾‹å¤–ã‚’å¼•æ•°ã«ã¨ã‚Šä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‹.
    -   ä¾‹å¤–ã¯Javaã®ã‚¯ãƒ©ã‚¹ã§ä½œæˆã§ãã‚‹(Exception. )
    -   Clojureã®è¨˜æ³•ã§ex-infoã¯messageã¨mapã‚’å—å–ãƒªä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‹.
    -   Clojureã®è¨˜æ³•ã§ex-dataã¯ex-infoã§å…¥åŠ›ã—ãŸmapã‚’å±•é–‹ã™ã‚‹.

<!--listend-->

```clojure
(try
  (throw (ex-info "bad" {:a 1 :b 2}))
  (catch clojure.lang.ExceptionInfo e
    (prn "caught" e)))
```

ex-messageãŒè¡Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸, ex-dataãŒè©³ç´°æƒ…å ±.

```clojure
(try
  (let [response (http/post
                   "http://localhost:8080/v1/leads"
                   {:form-params {:foo "somethingBad"}})]
    (log/info "This is the response" response))
  (catch Exception e
    (log/error (str "Oops! " (ex-message e)))
    (log/error (str "Because! " (ex-data e))))
```


## é€£ç¶šçš„ãªãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£å‘¼ã³å‡ºã—ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã©ã†ã™ã‚‹ã‹å•é¡Œ {#39688d}

Clojureã§ã‚·ã‚¹ãƒ†ãƒ ã®å¤–éƒ¨ã¨ã‚„ã‚Šã¨ã‚Šã‚’ã™ã‚‹ã¨ãã«ï¼Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ä¸€é€£ã®å‹•ä½œã‚’ã™ã‚‹ã‚·ãƒ¼ãƒ³ãŒã‚ˆãã‚ã‚‹. ã“ã®ã¨ã, ä¾‹å¤–å‡¦ç†ã‚’ã©ã†ã™ã‚‹ã‹å•é¡Œ. ã¨ãã«RESP APIå‘¼ã³å‡ºã—ã‚„DBã¨ã®é€šä¿¡ãªã©ã§é »ç™ºã™ã‚‹.

```clojure
(try
   (let [value (func-that-throws)]
      (act-on-value value))
   (catch Exception e
      (log/error e "func-that-throws failed")))
```

threading-macroã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹ã‚ˆã†ã«Railway oriented programming?ã§è¨˜è¿°ã™ã‚‹ã»ã†ã»ã†ã¨, try-catchã¨ifã‚’ç”¨ã„ã¦ã‚´ãƒªã‚´ãƒªå‡¦ç†ã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ã‚ˆã†ã .

ref. [Clojure ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° at 2021 - Qiita](https://qiita.com/MeguruMokke/items/530159edf0c41a9df6b1)

æ‰‹ç¶šãçš„ãªå‡¦ç†ã‚’letã«ãšã‚‰ãšã‚‰æ›¸ã„ã¦ã„ãã®ã¯ã©ã†ã‚‚é•å’Œæ„ŸãŒã‚ã‚‹(å€‹äººçš„ãªæ„Ÿæƒ³). ãã†ã™ã‚‹ã¨ã‚¹ãƒ¬ãƒƒãƒ‡ã‚£ãƒ³ã‚°ãƒã‚¯ãƒ­ã§bodyã«æ›¸ã„ã¦ã„ãã‚¹ã‚¿ã‚¤ãƒ«ã¯ã‚ˆã‚ŠClojureã‚‰ã—ãã¦ã‚³ãƒ¼ãƒ‰ã®è¦‹ãŸç›®ã¯ã‚ˆã„. ã—ã‹ã—ä»•çµ„ã¿ãŒdefaultã§Clojureã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„ã®ã§æ±ç”¨çš„ã§ã¯ãªã„. æ‰‹ç¶šããŒæ•°å€‹ã«éããªã„ãªã‚‰ã°tryã¨letã¨if, ãã†ã§ãªã‘ã‚Œã°railwayã‚’ä½¿ãˆã°ã„ã„ã‹ãª.


### Railway oriented programming(é‰„é“æŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°) {#349a21}

é‰„é“æŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯ã€F# ã§æœ‰åã ã£ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«. é–¢æ•°ã®è¿”ã‚Šå€¤ã«æ­£å¸¸ç³»ã®çµæœ result ã¨ãã‚Œä»¥å¤–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ err ã®ã‚¿ãƒ—ãƒ« [result, err] ã‚’æƒ³å®šã—ã€å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã®å„ãƒ—ãƒ­ã‚»ã‚¹ã§å¾—ã‚‰ã‚Œã‚‹ err ãŒ nil ã§ãªã„æ™‚ Early-Return ã‚’ã‹ã‘ã‚‹æ–¹å¼. (Scalaã‚„Haskellã§ã‚‚åˆã£ãŸæ°—ãŒã™ã‚‹).

-   refs.
    -   [Railway oriented programming, clojure and exception handling: why and how?](https://medium.com/appsflyer/railway-oriented-programming-clojure-and-exception-handling-why-and-how-89d75cc94c58)

---

ã•ã‚‰ã«, Javaã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ãã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¾‹å¤–ã‚’æŒ™ã’ãšã«Nullã‚’è¿”ã™ã¨ãã¯ **some->** ã¨ã„ã†ã‚¹ãƒ¬ãƒƒãƒ‡ã‚£ãƒ³ã‚°ãƒã‚¯ãƒ­ã‚’ä½¿ã†æ–¹æ³•ã‚‚Clojureã®ã‚¬ã‚¤ãƒ‰ã«ã‚ã£ãŸ.

ref. [some-> - Threading Macros Guide](https://clojure.org/guides/threading_macros#_some_some_and_cond)


### try-catch and if-let {#826a20}

tryã¨letã‚’ã¤ã‹ã£ã¦æ„šç›´ã«æ›¸ã. ã‚³ãƒ¼ãƒ‰ã¯æ±šããªã‚‹ã‚‚ã®ã®å®Ÿè£…ã‚‚ç†è§£ã‚‚ã“ã£ã¡ã¯å®¹æ˜“.

ref. [ğŸ”if-let ã¯å‡¦ç†ã®çµæœã«ã‚ˆã‚‹åˆ†å²ã§ã¤ã‹ã†]({{< relref "20220116083656.md#cf8a7205-5993-4091-af92-a611dd48fd38" >}})

---

try-letã¨ã„ã†ãƒã‚¯ãƒ­ã‚’æä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚ã‚ã‚‹.

-   refs.
    -   [clojure - How to handle exceptions that occur in let bindings or body - Stack Overflow](https://stackoverflow.com/questions/20335760/how-to-handle-exceptions-that-occur-in-let-bindings-or-body)
    -   [GitHub - rufoa/try-let: Better exception handling for Clojure let expressions](https://github.com/rufoa/try-let)


### ğŸ¤”ãã‚‚ãã‚‚Consistentã‚’è€ƒæ…®ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã™ã‚‹ã¹ããªã®ã‹ {#d1adfc}

Clojureã¯ä¸¦åˆ—ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å¼·ãæ„è­˜ã—ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã„ã†æ¦‚å¿µã‚‚ã‚ã‚‹ãã‚‰ã„ãªã®ã§ä¸€é€£ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é€”ä¸­ã§ã‚¨ãƒ©ãƒ¼ãŒå¤±æ•—ã—ãŸã‚‰ãã®ä¸€é€£ã®å‡¦ç†è‡ªä½“ãã®ã‚‚ã®ã‚’å¤±æ•—ã•ã›ã‚‹ã‚ˆã†ã«ä½œã‚‹ã¹ããªã®ã‹ã‚‚ã—ã‚Œãªã„. ã¤ã¾ã‚ŠConsistent, ä¸€è²«æ€§ã¨ã„ã†æ¦‚å¿µ.


## slingshot: Enhanced throw and catch for Clojure {#2e6ef68b-b405-489c-8194-17a5e54f3b6d}

ref. [GitHub - scgilardi/slingshot](https://github.com/scgilardi/slingshot)

Clojureã¯åŸºæœ¬çš„ã«Javaã®ä¾‹å¤–ã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã™ã‚‹ãŒ, ã•ã‚‰ã«Clojureã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª.

ãŸã¨ãˆã° [clj-http]({{< relref "20220209102028.md#13a79f1f-0d95-4f2a-8c4c-b77c4ed69be1" >}}) ã§ã¯ HTTP ResponseãŒæ­£å¸¸çµ‚äº†ä»¥å¤–ã®å ´åˆã¯ã“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ãŸã‚, slingshotã«åˆã‚ã›ãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒæœŸå¾…ã•ã‚Œã‚‹.

**try+** ã¨ **thorw+** ã¨ã„ã†ï¼’ã¤ã®ãƒã‚¯ãƒ­ã‚’æä¾›.


### Referenecs {#e2d205}

-   [Part6: TODO ã‚¢ãƒ—ãƒªã‚’çµ„ã¿ä¸Šã’ã‚‹ â€” ã‚¨ãƒ©ãƒ¼ã‚’ã†ã¾ãå‡¦ç†ã™ã‚‹](https://ayato-p.github.io/clojure-beginner/intro_web_development/part6_build_up_our_app.html#id12)
    -   slingshotã‚’ã¤ã‹ã£ãŸãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¾‹(ja).


## Clojureä¾‹å¤–ã®ãƒˆãƒ”ãƒƒã‚¯ {#8afb1f}


### <span class="org-todo todo _">âš™</span> pcoll pattern on Clojure {#896dfae0-53c2-4dad-b89c-334bf587fd29}

é–¢æ•°å‘¼ã³å‡ºã—ã‚’try-catchã§åŒ…ã‚€æ–¹æ³•.

```clojure
(defn pcall [f & args]
  (try
    [true (apply f args)]
    (catch Exception e [false e])))
```

ref. [pcoll pattern in clojure http request]({{< relref "20220209102028.md#3f097ce3-22de-4fa6-b151-0e9a6f2d905d" >}})


## <span class="org-todo todo _">ğŸ”—</span> References {#d95867}

-   [Exceptions in Clojure](https://grishaev.me/en/clj-book-exceptions/)
    -   ã‘ã£ã“ã†ãªåˆ†é‡ã ã‘ã©Clojureã®ä¾‹å¤–ã®è©±é¡Œã‚’ç¶²ç¾…çš„ã«ã„ã‚ã„ã‚æ›¸ã„ã¦ã‚‹.
