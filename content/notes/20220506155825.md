+++
title = "ğŸ“Clojure ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰(multimethod)"
tags = ["WIKI"]
draft = false
+++

-   up: [ğŸ“Clojure Expression Problem]({{< relref "20220307162746.md" >}})
-   refs.
    -   [ğŸ”—defmulti - clojure.core | ClojureDocs](https://clojuredocs.org/clojure.core/defmulti)
    -   [ğŸ”—ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰(multimethod)ã¨éšå±¤ - clojure.org(ja)](https://japan-clojurians.github.io/clojure-site-ja/reference/multimethods)


## ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰(multimethod)ã¨ã¯ {#ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰--multimethod--ã¨ã¯}

ã²ã¨è¨€ã§è¨€ã„æ›ãˆã‚Œã°, æ¡ä»¶åˆ†å²ãŒã—ãŸããªã£ãŸã‚‰ç¾ã—ãã‚­ãƒ¡ã‚‹æŠ€.

æ“ä½œã®æ¡ä»¶åˆ†å²ã®è¤‡é›‘ã•ã®èª²é¡Œ([Expression Problem]({{< relref "20220307102236.md" >}}))ã‚’è§£æ±ºã™ã‚‹ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹.

---

Javaã® ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã‚’Clojureã§å®Ÿç¾ã™ã‚‹æ–¹æ³•.

åŒä¸€åç§°ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ç•°ãªã‚‹å‹ã«ã‚ˆã£ã¦å‡¦ç†ã‚’åˆ†ã‘ã‚‹ã‚ˆã†ãªã“ã¨ã‚’ã—ã‚ˆã†ã¨ã™ã‚‹ã¨Clojureã§ã¯,

-   **defmulti** ã§è¤‡æ•°ã®å‡¦ç†ã‚’åˆ†å²ã•ã›ã‚‹ãŸã‚ã®åŒä¸€åç§°ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©.
-   **defmethod** ã§ç•°ãªã‚‹å‡¦ç†ã‚’å‹ã”ã¨ã«è¨˜è¿°.

defmultiã§ä¸ãˆã‚‰ã‚ŒãŸå¼•æ•°ã®ã©ã‚Œã‚’dispatchã®ãŸã‚ã®åˆ†å²æ¡ä»¶ã«ã™ã‚‹ã‹ã‚’å®šç¾©ã™ã‚‹. ã„ã„ã‹ãˆã‚Œã°, å¼•æ•°ã‚’ã°ã‚‰ã—ã¦åˆ†å²æ¡ä»¶ã‚’æ±ºã‚ã‚‹. defmethodã§åˆ†å²æ¡ä»¶ã«åŸºã¥ã„ã¦ä¸ãˆã‚‰ã‚ŒãŸå¼•æ•°ã‚’å‡¦ç†ã™ã‚‹.

Javaã ã¨Classã«ã‚ˆã£ã¦ç•°ãªã‚‹å®Ÿè£…ã‚’å‘¼ã³å‡ºã™, Clojureã ã¨å¼•æ•°ã™ã¹ã¦ã«ãŠã„ã¦ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒå¯èƒ½ã¨ã„ã†ç‚¹ã«ãŠã„ã¦Javaã‚ˆã‚Šå¼·åŠ›ãªæ–‡æ³•ã«ãªã£ã¦ã„ã‚‹.


### quick example {#quick-example}

å¼•æ•° sã«å¯¾ã™ã‚‹ãƒãƒ©ã—æ–¹ã‚’å®šç¾©.

```clojure
(defmulti my-print class)
```

class ã¯ (fn [x] (class x)) ã¨ã„ã†ç„¡åé–¢æ•°ã®ç³–è¡£æ§‹æ–‡ã«ã™ããªã„.

å¼•æ•°sãŒstring, ã¤ã¾ã‚Š (class s) => String ãªã‚‰ã°(.write **out** s)ã‚’å®Ÿè¡Œ.

```clojure
(defmethod my-print String [s] (.write *out* s))
(defmethod my-print nil [s] (.write *out* "nil"))
```

multimethodå‘¼ã³å‡ºã—.

```clojure
(my-print "stu")
```


## ğŸ’¡ã„ã¤ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã¹ãã‹? {#ã„ã¤ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã¹ãã‹}

ref.) [ğŸ“šProgramming Clojure]({{< relref "20220307081341.md" >}}) ã‚ˆã‚Šå¼•ç”¨.

ç­†è€…ãŒã©ã‚“ã¨ãªã“ã‚ã§ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹èª¿æŸ»ã—ãŸã¨ãã®ç™ºè¦‹.

-   ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ã¯ **ã‚ã£ãŸã«ä½¿ã‚ã‚Œãªã„**.
-   ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚ŠDispatchã—ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„.

ç­†è€…ã«ã‚ˆã‚‹ææ¡ˆ.

-   é–¢æ•°ãŒ1ã¤ã¾ãŸã¯è¤‡æ•°ã®å‹ã«ã‚ˆã£ã¦åˆ†å²ã—ã¦ã„ãŸã‚‰, ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¤œè¨ã™ã‚‹. å‹ã¨ã¯ã‚¯ãƒ©ã‚¹ã‚„keywordã«é™ã‚‰ãªã„. ã‚ãªãŸãŒåˆ†å²ã™ã‚‹ã‚‚ã®ã¨æ„Ÿã˜ã‚‹ã‚‚ã®.
-   åˆ¤æ–­ã«è¿·ã£ãŸã‚‰é–¢æ•°ç‰ˆã¨ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ç‰ˆã‚’ä¸¡æ–¹æ›¸ã„ã¦ã¿ã¦èª­ã¿ã‚„ã™ã„æ–¹ã‚’é¸ã¶.

---

ğŸ¤”ã‚‚ã—æ¡ä»¶åˆ†å²ãŒæ•°å€‹ã§åˆ†å²ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ±‚ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã‚‚å˜ç´”ãªã‚‰multimethodã¯ã„ã‚‰ãªã„ã‹ã‚‚ã—ã‚Œãªã„. 3ã¤ä»¥ä¸Šãªã©è‡ªåˆ†ã§åŸºæº–ã‚’æŒã£ã¦ãŠãã®ã‚‚ã„ã„ã‹ã‚‚(æ¨æ¸¬ã ã¨ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã¤ã‹ã†ã®ã‹ãªï¼Ÿãã†ãªã‚‰ã°å¤šç”¨ã™ã‚‹ã®ã¯å•é¡Œãªæ°—ãŒã—ãŸ).


## clojure multimethod HOWTO {#clojure-multimethod-howto}

ç‰¹å®šæ¡ä»¶ã«ã‚ˆã‚‹ifæ–‡, switchæ–‡, caseæ–‡ã®ãŠã°ã‘ã«ãªã‚Šãã†ãªã¨ãã¯ç©æ¥µçš„ã«å°å…¥ã—ãŸã„ã¨ã“ã‚. å‹ã¨ã¯ã‚¯ãƒ©ã‚¹ã‚„keywordã§ã¯ãªãåˆ†å²ã—ãŸã„å…¨ã¦, ã¨ã„ã†ã“ã¨ã§ã„ã‚ã„ã‚ã¾ã¨ã‚ã‚‹.


### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„ {#ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„}

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹ä¾‹.

```clojure
(defmulti ->foo (fn [x y] x))
(defmethod ->foo :type-a [x y] y)
(->foo :type-a {})
```


### ã‚­ãƒ¼ã«bindã•ã‚Œã¦ã„ã‚‹valueã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„ {#ã‚­ãƒ¼ã«bindã•ã‚Œã¦ã„ã‚‹valueã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„}

```clojure
(def m {:a "hoge"})

(defmulti ->foo :a)
(defmethod ->foo "hoge" xxx)
```

defmultiã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒä¸ãˆã‚‰ã‚Œã¦ã‚‚å®Ÿéš›ã¯ (fn [x] (get x :a)) ã®ç³–è¡£ã®é–¢æ•°ã§ã‚ã‚‹ã¨ã“ã‚ã¯ãƒãƒã£ãŸ...

è¤‡æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ ã§ã„ã‘ã‚‹(ref. [juxt]({{< relref "20220116094551.md#clojure-juxt" >}})).

```clojure
;; Define the multimethod
(defmulti service-charge (juxt :id :tag))

;; Handlers for resulting dispatch values
(defmethod service-charge [::acc/Basic   ::acc/Checking] [_] 25)
(defmethod service-charge [::acc/Basic   ::acc/Savings]  [_] 10)
```


### namespaceã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„ {#namespaceã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„}


### typeã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„ {#typeã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„}


### ã‚¯ãƒ©ã‚¹ã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„ {#ã‚¯ãƒ©ã‚¹ã§å‡¦ç†ã‚’åˆ†å²ã—ãŸã„}


## ğŸ”—References {#references}

-   ãƒãƒ«ãƒãƒ¡ã‚½ãƒƒãƒ‰ã¯ [Integrant]({{< relref "20220211142329.md#clojure-integrant" >}}) ã§å¤šç”¨ã•ã‚Œã¦ã„ã‚‹.
-   [ğŸ’¡preferring to build a large library of functions on a small set of types]({{< relref "20220116161735.md#preferring-to-build-a-large-library-of-functions-on-a-small-set-of-types" >}})
