+++
title = "ğŸ“ClojureScripté–‹ç™ºç’°å¢ƒ"
tags = ["WIKI"]
draft = false
+++

-   refs:
    -   [ğŸ“Clojure é–‹ç™ºç’°å¢ƒ]({{< relref "20220119063524.md" >}})
    -   [ğŸ·ClojureScript]({{< relref "20220514174914.md" >}})


## Build Tools {#build-tools}

shadow-cljsã‚’ä½¿ã†ã‹ã€figwheelã‚’ä½¿ã†ã‹. lumoã¯2022ã¯ã‚ªãƒ¯ã‚³ãƒ³ï¼Ÿ

-   [shadow-cljs](https://github.com/thheller/shadow-cljs)
    -   cljsã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸã‚Šãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆ.
-   [figwheel-main](https://figwheel.org/)
    -   è‡ªå‹•ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¨ãƒ›ãƒƒãƒˆã‚³ãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®æ©Ÿèƒ½ã‚’æä¾›.
-   [ClojureScript + React / React Nativeã®é››å½¢ã¾ã¨ã‚ - Qiita](https://qiita.com/funatsufumiya/items/1367bdd780b7d69c6b09)
    -   2021ãªã®ã§æœ€è¿‘ã®æƒ…å ±.

shadow-cljsã¨figwheel-mainã®é•ã„ã¯npmã«ä¾å­˜ã™ã‚‹ã‹ã©ã†ã‹. shadow-cljsã¯npmã‚’åˆ©ç”¨ã™ã‚‹ i.e. ã‚ˆã‚ŠJavaScriptã¨ã®é€£æºã‚„å…±å­˜ãŒã—ã‚„ã™ã„. ã“ã®è¦³ç‚¹ã§ã©ã¡ã‚‰ã®ãƒ„ãƒ¼ãƒ«ã‚’é¸æŠã™ã‚‹ã‹ã¯é¸ã‚“ã ã»ã†ãŒã‚ˆã•ãã†.


## shadow-cljs {#shadow-cljs}

**shadow-cljs.edn** ã«è¨­å®šã‚’æ›¸ã„ã¦ã„ã.


### shadow-cljsã‚³ãƒãƒ³ãƒ‰ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ {#shadow-cljsã‚³ãƒãƒ³ãƒ‰ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹}

npm pacakgeã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸshadow-cljsã‚³ãƒãƒ³ãƒ‰ã®ä½¿ã„æ–¹ã¾ã¨ã‚.

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ–°è¦.

```sh
$ npx create-cljs-project my-project

# ã™ã§ã«package.jsonãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ã‚‹ã¨ã
$ npm install --save-dev shadow-cljs

# ã‚‚ã—ãã¯globalç’°å¢ƒã¸
$ npm install -g shadow-cljs
```

Basic Development Commands.

```sh
# compile a build once and exit
$ shadow-cljs compile app

# compile and watch
$ shadow-cljs watch app

# connect to REPL for the build (available while watch is running)
$ shadow-cljs cljs-repl app

# connect to standalone node repl
$ shadow-cljs node-repl

# Running a release build optimized for production use.
$ shadow-cljs release app
```

Server Mode Commands.

```sh
# running server-mode
$ shadow-cljs server
$ shadow-cljs clj-repl

$ shadow-cljs start
$ shadow-cljs stop
$ shadow-cljs restart
```


### REPLã®locahostã®portæ•´ç† {#replã®locahostã®portæ•´ç†}

server modeã§ç«‹ã¡ä¸Šã’ã‚‹ã¨ã„ã‚ã„ã‚ã§ã¦ãã‚‹ã®ã§æ•´ç†.

```example
shadow-cljs - HTTP server available at http://localhost:3000
shadow-cljs - HTTP server available at http://localhost:8080
shadow-cljs - server version: 2.18.0 running at http://localhost:9630
shadow-cljs - nREPL server started on port 38105
```

-   localhost:3000ã¯ shadow-cljs.ednã§è‡ªåˆ†ã§è¨­å®š, devtoolsç”¨.
-   localhost:8080ã¯ shadow-cljs.ednã§è‡ªåˆ†ã§è¨­å®š, Webè¡¨ç¤ºç¢ºèªç”¨.
-   localhost:9630ã¯shadow-cljsã®ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ãŒä¸¦ã¶.
-   localhost:38105ã¯nREPLã‚ˆã†ã§CIDERã‹ã‚‰æ¥ç¶šã™ã‚‹.

ä¾‹ãˆã°cider-connectã‚’ã™ã‚‹ã¨ãã¯nREPLã®ãŸã‚ã®38105ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹.


### 3ã¤ã®REPLã®æ•´ç†(clj-repl/node-repl/browser-repl) {#3ã¤ã®replã®æ•´ç†--clj-repl-node-repl-browser-repl}

shadow-cljsã®èµ·å‹•ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§3ã¤ã‚’æŠ‘ãˆã¦ãŠã.

-   clj-repl(server-mode)
-   ndoe-repl
-   browser-repl

<!--listend-->

```sh
$ shadow-cljs server
$ shadow-cljs clj-repl
```

**clj-repl(server-mode)** ã¯ é–‹ç™ºç”¨ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨ãã«ã¤ã‹ã†. clojurescriptã‚’é•·æ™‚é–“Loopã•ã›ã¦ã„ã‚‹.

```sh
$ shadow-cljs node-repl
$ shadow-cljs browser-repl
```

**node-repl** ã¯node.jsã§èµ·å‹•ã™ã‚‹REPL. ã“ã‚Œã¯Javaã§å‹•ãClojureã®REPLã¨åŒã˜.

**browser-repl** ã¯ node-replã¨æ©Ÿèƒ½ãŒå¤‰ã‚ã‚‰ãªã„ã‚‚ã®ã®Browserã®
JavaScriptã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ¢ãƒ¼ãƒ‰.


### deps.ednã¨shadow-cljsã‚’å…±å­˜ã•ã›ã‚‹ã«ã¯ï¼Ÿ {#deps-dot-ednã¨shadow-cljsã‚’å…±å­˜ã•ã›ã‚‹ã«ã¯}

defaultã§ã¯node.jsã®ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹package.jsonã‚’åˆ©ç”¨ã™ã‚‹ãŒã‚„ã¯ã‚ŠClojureã‚’ã¤ã‹ã£ã¦ã‚‹ã¨ [Leiningen]({{< relref "20220119063524.md#leiningen-clojure-build-tool" >}}) ã‚„ [Clojure CLI]({{< relref "20220119063524.md#clojure-cli-tools-dot-deps-clojure-build-tool" >}}) ã¨å…±å­˜ã•ã›ãŸã„ã¨ã“ã‚ã .

ref. [tools.deps / deps.edn](https://shadow-cljs.github.io/docs/UsersGuide.html#deps-edn)


### References {#references}

-   [Shadow CLJS Userâ€™s Guide](https://shadow-cljs.github.io/docs/UsersGuide.html#_introduction)
-   [clojurescriptã®shadow-cljsã«ã¤ã„ã¦ - Qiita](https://qiita.com/lambda-knight/items/a69df35405b26f7a79cf)
-   [shadow-cljs - Qiita](https://qiita.com/iku000888/items/5c12c999c0d49cc2c4b0)
-   [shadow-cljs/quickstart-browser/README-ja.mdÂ· GitHub](https://github.com/shadow-cljs/quickstart-browser/blob/master/README-ja.md)
    -   èª°ã‹ãŒquickstartã‚’æ—¥æœ¬èªã«è¨³ã—ã¦ãã‚ŒãŸ.


## with Browser {#with-browser}

Google Chrome or FirefoxãŒé¸æŠè‚¢. ãã‚Œã‚‰ã®Devtoolsã¨é€£æº.

-   [GitHub - binaryage/cljs-devtools](https://github.com/binaryage/cljs-devtools)
    -   A collection of Chrome DevTools enhancements for ClojureScript developers.
-   Source mapsã®å°å…¥ã«ã‚ˆã£ã¦JavaScriptã®ãƒ‡ãƒãƒƒã‚°ãŒæ¥½ã«ãªã‚‹.
    -   sourcemapã¯JavaScriptã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®å¤‰æ›å‰ã¨å¤‰æ›å¾Œã®å¯¾å¿œé–¢ä¿‚ã‚’ç¤ºã™jsonãƒ‡ãƒ¼ã‚¿. ã“ã‚ŒãŒãªã„ã¨JavaScriptã‹ã‚‰ãã‚Œã«å¯¾å¿œã™ã‚‹ã‚½ãƒ¼ã‚¹ãŒè¾¿ã‚Œãªã„.
    -   sourcemapãŒã‚ã‚Œã°Chromeã‹ã‚‰ã‚½ãƒ¼ã‚¹ãŒã¿ã‚Œã‚‹.
    -   [ClojureScript - Source maps](https://clojurescript.org/reference/source-maps)
-   [GitHub - binaryage/dirac](https://github.com/binaryage/dirac)
    -   ClojureScriptç”¨ã®Chromeæ‹¡å¼µ, fork for Chrome Devtools.


## with CIDER {#with-cider}

ref. [Emacs CIDER]({{< relref "20220316151158.md#emacs-cider" >}})

M-x cider-jack-in-cljsã§jack-in or M-x cider-connect-cljsã§connect.

---

shadow-cljsã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ **Seeect ClojureScript REPL type:** ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã§shadowã‚’é¸æŠã™ã‚‹. ã•ã‚‰ã«shadow-cljs.ednã§å®šç¾©ã—ãŸbuild nameã‚’é¸æŠã™ã‚‹ã¨æ¥ç¶šå®Œäº†. ã‚‚ã—ãã¯ **.dir-locals.el** ã«è¨­å®šã‚’æ›¸ã„ã¦ãŠãã“ã¨ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›ã¯çœç•¥ã§ãã‚‹.

```emacs-lisp
((nil . ((cider-default-cljs-repl . shadow)
         (cider-shadow-default-options . "<your-build-name-here>"))))
```

---

jack-inã«ã‚ˆã£ã¦ ClojureScriptã®REPLãŒnREPLã¨é€£æºã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ãŒè‡ªå‹•ã§çµ„ã¿è¾¼ã¾ã‚Œã‚‹.

-   nrepl/nrepl
-   refactor-nrepl
-   cider/cider-nrepl
-   [cider/piggieback](https://github.com/nrepl/piggieback)

ã—ãŸãŒã£ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰cljã§èµ·å‹•ã—ã¦Emacsã‹ã‚‰cider-connectã™ã‚‹å ´åˆã¯ã“ã‚Œã‚‰ã®ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’deps.ednã«è¨˜å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹.

```clojure
;; clojure -M:nrepl:local
{:aliases
 {:local
  {:extra-deps {cider/piggieback              {:mvn/version "0.4.2"}
                nrepl/nrepl                   {:mvn/version "0.9.0"}
                refactor-nrepl/refactor-nrepl {:mvn/version "3.5.2"}
                cider/cider-nrepl             {:mvn/version "0.28.3"}
                org.clojure/clojure           {:mvn/version "1.11.1"}}}
  :nrepl
  {:main-opts
   ["-m" "nrepl.cmdline"
    "--middleware"
"[cider.nrepl/cider-middleware,cider.piggieback/wrap-cljs-repl]"]}}}
```

---

shadow-cljsã®å ´åˆ, jack-in-cljsã‚’ã™ã‚‹ã“ã¨ã§shadow-cljs.ednãŒãŠã„ã¦ã‚ã‚Œã°shadow-cljsã¨è§£é‡ˆã•ã‚Œã¦è‡ªå‹•ã§serverãŒç«‹ã¡ä¸ŠãŒã£ã¦connectã¾ã§ã—ã¦ãã‚Œã‚‹. ã‚‚ã—ãã¯ **shadow-cljs server** ã‚³ãƒãƒ³ãƒ‰ã§ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’M-x cider-connectã§æ¥ç¶šã§ãã‚‹.

---

-   [CIDER | Shadow CLJS Userâ€™s Guide](https://shadow-cljs.github.io/docs/UsersGuide.html#cider)
-   [ClojureScript | CIDER Docs](https://docs.cider.mx/cider/basics/clojurescript.html)
