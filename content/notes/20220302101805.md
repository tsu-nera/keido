+++
title = "ğŸ“Clojure Tips"
tags = ["WIKI"]
draft = false
+++

refs: [ğŸ“‚Clojure Core]({{< relref "20220112142936.md" >}}) [ğŸ·Clojure]({{< relref "20211111225741.md" >}})

ã‚¤ãƒ‡ã‚£ã‚ªãƒ ã‚’é§†ä½¿ã™ã‚‹ã¨ãƒ¢ãƒ†ã‚‹ã¨ã‹.

Clojureã®ä¸»ã«ãƒ‡ãƒ¼ã‚¿æ“ä½œã«é–¢ã™ã‚‹å°æŠ€ã‚’æ›¸ãæºœã‚ã¦ã„ã.

Ankiã«çªã£è¾¼ã‚€ã“ã¨ã§è¨˜æ†¶ã‚‚ã—ã¦ã„ã.


## Collectionsä¸€èˆ¬ {#6419fb}


### ãƒªã‚¹ãƒˆã«valueã‚’å«ã‚€ã‹ã¨ã„ã†åˆ¤å®š {#6d0755}

å°‘ã—ã‚„ã£ã‹ã„. **contains?** ã¯ Mapã«keyãŒå«ã¾ã‚Œã‚‹ã‹ã‚’åˆ¤å®š. ã¾ãŸ **includes?** ã¯æ–‡å­—åˆ—ã®ã¨ãã«ã¤ã‹ã†.

ãƒªã‚¹ãƒˆã«å€¤ãŒå«ã¾ã‚Œã‚‹ã‹ã¯ãªã‚“ã¨contains?ã§ã¯åˆ¤å®šã§ããªã„.

Javaã®é–¢æ•°ã‚’ä½¿ã†ã®ãŒã„ã„.

```clojure
(.contains [100 101 102] 101) => true
```

ref: [data structures - Test whether a list contains a specific value in Clojure - Stack Overflow](https://stackoverflow.com/questions/3249334/test-whether-a-list-contains-a-specific-value-in-clojure)


## nilã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¾ã¨ã‚ {#0fbf4219-4020-4829-ae01-f057df406c59}

ã‚‚ã—nilãªã‚‰(not-nil)ãªã‚‰...ã‚’ã¾ã¨ã‚ã‚‹(ref. [ğŸ“Clojure Logics]({{< relref "20220116081924.md" >}})).


### andã¨orã‚’æ¡ä»¶åˆ†å²ã«ã¤ã‹ã† {#420b5cde-0746-4e0d-879b-0c6697b473c3}

orã«ä¸ãˆã‚‰ã‚ŒãŸå¼ã§çœŸã«ãªã‚‹ã‚‚ã®ãŒè¦‹ã¤ã‹ã£ãŸã‚‰æ®‹ã‚Šã‚’è©•ä¾¡ã›ãšã«çœŸã‚’è¿”ã™(cf. [yogthos/config](https://github.com/yogthos/config/blob/81750c8fdb946050a8074f14ab03c8b226536b1a/src/config/core.clj#L57)).

andã«ä¸ãˆã‚‰ã‚ŒãŸå¼ã§å½ã«ãªã‚‹ã‚‚ã®ãŒè¦‹ã¤ã‹ã‚‰ãªã„é™ã‚Šæ®‹ã‚Šã‚’è©•ä¾¡ã™ã‚‹.

ref: [ğŸ“šLand of Lisp]({{< relref "20211113235959.md" >}}) p47ã«æ›¸ã„ã¦ã‚ã£ãŸæ–¹æ³•.


### é–¢æ•°ã®å¼•æ•°ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®šã™ã‚‹ã«ã¯ï¼Ÿ {#18999971-4a76-4a34-be2d-57c97b0fafdb}

ã„ã‚ã‚†ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¨ã„ã†ã‚‚ã®ã ãŒ, ä½ç½®å¼•æ•°ã«å€¤ã‚’è¨­å®šã™ã‚‹æ–¹æ³•ã¯è¦‹å½“ãŸã‚‰ãªã„(è¦‹ã¤ã‘ã‚‰ã‚Œã¦ãªã„ã ã‘ã‹ã‚‚).

ä»£ã‚ã‚Šã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°ã¨ [ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°]({{< relref "20220305075933.md#4c510cea-aa58-487e-b766-8a164dd1351f" >}}) ã®æ–‡æ³•ã®çµ„ã¿åˆã‚ã›ã§ã§ãã‚‹.

[åˆ†é…æŸç¸›(Destructuring)]({{< relref "20220116094551.md#05d3e8d4-ab78-4327-ba4f-c51fdda1c173" >}}) ã® **or** ã‚’æ´»ç”¨ã™ã‚‹.

```clojure
(defn myfunc
  [arg & {:keys [opt1 opt2] :or {opt1 "default1" opt2 "default2"}}]
  (format "arg=[%s] opt1=[%s] opt2=[%s]" arg opt1 opt2))

(myfunc "argument" {:opt1 "option1"})
;; => "arg=[argument] opt1=[option1] opt2=[default2]"
```

---

ãŸã‚“ã«å¤‰æ•°ãŒnilãªã‚‰ã°å€¤ã‚’è¨­å®šã™ã‚‹ãªã‚‰ã° **or** ã§ã„ã‘ã‚‹.

```clojure
(or input-argument "default")
```

ã¿ã‚„ã™ã•ã§ä½¿ã„åˆ†ã‘ã¦ã‚‚ã„ã„.


### fnil: nilã‚’ åˆæœŸå€¤ã§ç½®ãæ›ãˆã¦é–¢æ•°é©ç”¨ {#7ca03d}

ref. [fnil - clojure.core](https://clojuredocs.org/clojure.core/fnil)

ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚’ã—ã‚ˆã†ã¨ã—ãŸã¨ãã«,
å¼•æ•°ã§ã‚‚ã‚‰ã£ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒnilã®å ´åˆã¯åˆæœŸå€¤ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ç½®ãæ›ãˆã‚‹.

```clojure
(update request ::acc (fnil conj []) id)
```

ã“ã‚Œã®ã‚„ã‚ã†ã¨ã—ã¦ã„ã‚‹ã“ã¨ã¯, request mapã® ::accã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚ã‚‹vectorã«idã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã™ã‚‹ãŒ :acc ãŒrequest mapã«ãªã„ã¨ãã¯ç©ºã®vectorã‚’ç”¨æ„ã—ã¦ã•ã‚‰ã«idã‚’åŠ ãˆã‚‹.


### æ¡ä»¶ã¤ãifã§ã‚¹ãƒ¬ãƒƒãƒ‡ã‚£ãƒ³ã‚°ãƒã‚¯ãƒ­ {#2cb83f}

**identity** ã‚’ã¤ã‹ã†ã“ã¨ã§ã‚¹ã‚«ã—ã£ãºã§ãã‚‹. (identity x) ã¯xã‚’ã†ã‘ã¨ã£ã¦ãã‚Œã‚’ãã®ã¾ã¾è¿”ã™.

```clojure
 (let [third-step (if pred do-something identity)]
   (->> some-vec
        some-fn
        third-step
        further-processing))
;;;

(defn get
    [db & {:keys [queries] :or {queries identity}}]
    (-> db
        queries
        get))
```


### ã‚‚ã—nilã§ãªã‘ã‚Œã°do something, nilãªã‚‰ã°ãã®ã¾ã¾ {#c511b6}

ã‚‚ã—not-nilãªã‚‰ã°do something, nilãªã‚‰ã°ãã®ã¾ã¾å€¤ã‚’è¿”ã—ãŸã„.

whenã‚’ã¤ã‹ã†ã¨falseã®ã¨ãã«nilãŒæˆ»ã‚‹ãŒã“ã‚Œã¯æœŸå¾…å€¤ã§ã¯ãªã„. ifã‚’ä½¿ã†ã®ã¯å†—é•·. Threading Macrosã®cond->ã‚’ã¤ã‹ã†ã¨ãã‚Œã„ã«æ›¸ã‘ã‚‹.

ref. [cond-> æ¡ä»¶ã¤ãã‚¹ãƒ¬ãƒƒãƒ‰ãƒã‚¯ãƒ­]({{< relref "20220116162321.md#edc8041c-a7eb-4b51-8433-f8b1038b3ffc" >}})

```clojure
(cond-> v
  (not (nil? v)) (hoge))
```


### nilãªã‚‰Collectionã‹ã‚‰å–ã‚Šé™¤ã {#8df9e4}

(remove nil? coll) ã§ã„ã‘ã‚‹.


## map->map: Mapã®å˜ä½“å¤‰æ›ã¾ã¨ã‚ {#642b7c}


### select-keys: ã‚ã‚‹Mapã‹ã‚‰keywordã‚’æŒ‡å®šã—ã¦SubMapã‚’ä½œæˆ {#73f38f}

<https://clojuredocs.org/clojure.core/select-keys>

```clojure
(select-keys {:a 1 :b 2} [:a])
;;=> {:a 1}
```

ç‰¹å®šã®keywordsã‚’å‰Šé™¤ã—ã¦SubMapã‚’ã™ã‚‹ã‚ˆã†ãªã¨ãã¯dissocã‚’ã¤ã‹ã†. dissocã«ã¯è¤‡æ•°ã®keywordã‚’æŒ‡å®šå¯èƒ½.

```clojure
(dissoc {:a 1 :b 2 :c 3} :c :b)
;;=> {:a 1}
```


### rename-keys: Mapã®ã‚­ãƒ¼ã®åå‰å¤‰æ›´ {#104c92}

valueã«ã¯è§¦ã‚‰ãškeyã ã‘å¤‰æ›´ã™ã‚‹. åå‰ã¯å¤§äº‹.

<https://clojuredocs.org/clojure.set/rename-keys>

clojuer.setã«å…¥ã£ã¦ã„ã‚‹ã®ã§æ³¨æ„ï¼(select-keys ã¯ clojure.coreãªã®ã§é–“é•ãˆã‚„ã™ã„. )

```clojure
(clojure.set/rename-keys {:a 1 :b 2} {:a :new-a :b :new-b})
;; => {:new-a 1, :new-b 2}
```


### Mapã®è¦ç´ ã§groupingã™ã‚‹ {#9265dd}

çµ±è¨ˆå‡¦ç†ã®groupingç›¸å½“ã¯ **group-by** ã§å¯èƒ½.

```clojure
(group-by :tweet-id tweets)
```


### Mapã®ã‚­ãƒ¼(ãƒãƒªãƒ¥ãƒ¼)ã«å¯¾ã—ã¦å¤‰æ›ã‚’ã—ãŸã„(é–¢æ•°ã‚’mapã—ãŸã„) {#f1dfdd07-0be1-4ab5-9096-1929811cf6e9}

**reduce-kv** ã‚’ã¤ã‹ã†.

ref. [(reduce-kv f {} m) => m](#78ca0a6b-ce34-4f69-98a3-3f34aa980435)

å¤‰æ›ã®ãŸã‚ã®é–¢æ•°ã¯ (fn [m k v]... )ã®å¼•æ•°ã«ã™ã‚‹ã“ã¨.

ãŸã¨ãˆã° å€¤ã‚’å¤‰æ›ã—ãŸã„ãªã‚‰ã° (fn [m _ v] (... )) ã§é–¢æ•°ã‚’ä½œæˆã—ã¦å¤‰æ›ã—ãŸã‚‚ã®ã‚’mã«assocã™ã‚‹.


### æ¡ä»¶ä»˜ãMapæ“ä½œ: assoc-if/update-if è¿½åŠ ã™ã‚‹å€¤ãŒnilã§ãªã‘ã‚Œã°æ“ä½œ {#2d4f3e}

ã‚‚ã—valueãŒnilã§ãªã‘ã‚Œã°Mapã‚’æ“ä½œã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹.

```clojure
(defn assoc-if
  [m key value]
  (if value (assoc m key value) m))

(-> m
  (cond-> value (assoc key value)))
```

ğŸ¤” cond-> ã®è¨˜æ³•ãŒã‚­ãƒ¬ã‚¤. ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã¯å°‘ã—ã‚€ãšã‹ã—ã„ã‹ã‚‚. ãã‚‚ãã‚‚valueã‚’å–ã‚Šå‡ºã•ãªã„ã¨. ã„ã‚ã„ã‚ã¨ä»¥ä¸‹ã§è­°è«–ã•ã‚Œã¦ã„ã‚‹. æ±ç”¨çš„ã«æ›¸ãã¨é›£ã—ã„ã®ã§å€‹åˆ¥ã«get-inã—ãŸå€¤ã‚’å¤‰æ•°ã«ä¿å­˜ã—ã¦nilåˆ¤å®šã™ã‚Œã°ã„ã„ã‹ã‚‚.

ref. [dictionary - Clojure: idiomatic update a map's value IF the key exists - Stack Overflow](https://stackoverflow.com/questions/20136617/clojure-idiomatic-update-a-maps-value-if-the-key-exists)

nilã®æˆ»ã‚Šã‚’å½¢å®¹ã™ã‚‹ãªã‚‰ã°some->ã‚‚ã‚ã‚Šã‹ãª.

```clojure
(defn- get-attr [node attr]
       #_=>   (some-> node :attrs attr))
```


### æ¡ä»¶ä»˜ãMapæ“ä½œ: Mapã«valueãŒå­˜åœ¨ã—ãªã„ãªã‚‰ã°è¿½åŠ  {#83b921}

**merge** ã‚’ã¤ã‹ã†ã¨å·¦ã®Mapã¨å³ã®MapãŒã‚ã‚‹ã¨ãã¯å³(å¾Œã‚)ãŒå„ªå…ˆã•ã‚Œã‚‹. ã‚‚ã—valueãŒå­˜åœ¨ã™ã‚‹ãªã‚‰ã°ãªã«ã‚‚ã—ãŸããªã‘ã‚Œã°å³ã¨å·¦ã‚’å…¥ã‚Œæ›¿ãˆã‚Œã°ã„ã„.

ref. [clojure assoc-if and assoc-if-new - Stack Overflow](https://stackoverflow.com/questions/25035535/clojure-assoc-if-and-assoc-if-new)


### ãƒã‚¹ãƒˆã—ãŸCollectionæ“ä½œã«get-in/assoc-in/update-in {#bc52e1b1-fd87-4e17-844f-840a4ba0cffe}

get-in/assoc-in/update-in ã‚’ã¤ã‹ã†.

<https://clojuredocs.org/clojure.core/assoc-in>

```clojure
;; assoc-in into a nested map structure
(def foo {:user {:bar "baz"}})
(assoc-in foo [:user :id] "some-id")
;;=> {:user {:bar "baz", :id "some-id"}}
```

ref: [ğŸ“Clojure Map(clojure.core.map)]({{< relref "20220116080205.md#30a935ff-4448-43a2-8ec7-8c37e18b6ca5" >}})


## list-of-maps {#a32260}


### è¤‡æ•°ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ãã‚Œãã‚Œã®è¦ç´ ã‹ã‚‰mapã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ä½œæˆ {#a74f58}

ã„ã‚ã‚†ã‚‹Pythonã®zipã®ã‚ˆã†ãªã‚‚ã®. indexã‚’æƒãˆã¤ã¤, ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆæˆã—ãŸã„.

(map vector coll1 coll2)ã§2ã¤ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãã£ã¤ã‘ãŸã‚ã¨é–¢æ•°é©ç”¨(åˆ†é…æŸç¸›).

```clojure
(->> (map vector [1 2 3] [4 5 6])
     (map (fn [[x y]] {:a x :b y})))
```

forã‚’ã¤ã‹ã†ã¨2ã¤ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®é †åˆ—çµ„ã¿åˆã‚ã›ã«ãªã‚‹ã®ã§çµ„ã¿åˆã‚ã›çˆ†ç™ºã™ã‚‹.

doseqã‚’ã¤ã‹ã†ã¨nilãŒreturnã•ã‚Œã¦mapã¨çµ„ã¿åˆã‚ã›ã‚‰ã‚Œãªã„.


## list-of-lists {#6f16a0}


### ãƒã‚¹ãƒˆã—ãŸãƒªã‚¹ãƒˆ(å¯å¤‰é•·å¼•æ•°)ã«é–¢æ•°ã‚’é©ç”¨ã—ãŸã„ {#4e1359}

é–¢æ•°ã® [å¯å¤‰é•·å¼•æ•°é–¢æ•°]({{< relref "20220116094551.md#11aa1008-04ee-4554-9ebd-67470c0fc93f" >}}) å¯¾ã™ã‚‹é–¢æ•°é©ç”¨ã§ä½¿ãˆã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯.

```clojure
(defn hello [greeting & who]
  (println greeting who))
```

greetingã¨who(å¯å¤‰)ã«é–¢æ•°ã‚’é©ç”¨ã™ã‚‹ã«ã¯ [apply]({{< relref "20220116094551.md#f596204e-e198-4042-a21f-608c35e86fbf" >}}) ã‚’ã¤ã‹ã†.

ä»¥ä¸‹ã¯åŒã˜.

```clojure
(apply + 1 2 3 [4 5])
(apply + [1 2 3 4 5])
(apply + 1 2 3 4 5)
```


### ãƒªã‚¹ãƒˆã‚’ä¸€å®šã®å€‹æ•°ã”ã¨ã«ã¾ã¨ã‚ãŸã„(list of list aka. chunked list) {#b448de}

[clojure.core.partition](https://clojuredocs.org/clojure.core/partition) ã‚’åˆ©ç”¨ã™ã‚‹ã¨ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã—ãŸå€‹æ•°ã”ã¨ã«åˆ†å‰²ã§ãã‚‹.

nå€‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’må€‹ãšã¤ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«åˆ†å‰²ã™ã‚‹ã“ã¨ãŒã§ãã‚‹, ã„ã‚ã‚†ã‚‹ãƒãƒ£ãƒ³ã‚¯ãŒã§ãã‚‹.

```clojure
(partition 4 (range 20))
;;=> ((0 1 2 3) (4 5 6 7) (8 9 10 11) (12 13 14 15) (16 17 18 19))
```

ãƒãƒ£ãƒ³ã‚¯ã®æœ€å¾Œã§ãã‚Œã„ã«å‰²ã‚Šåˆ‡ã‚Œãªã„å ´åˆã¯åˆ‡ã‚Œæ¨ã¦ã‚‰ã‚Œã‚‹ã¨ã“ã‚ãŒæ€’ã‚Šãƒã‚¤ãƒ³ãƒˆ. ã“ã®å ´åˆã¯ **partition-all** ã¨ã„ã†åˆ¥ã®é–¢æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹.

```clojure
(partition 4 (range 18))
;; => ((0 1 2 3) (4 5 6 7) (8 9 10 11) (12 13 14 15))

(partition-all 4 (range 18))
;; => ((0 1 2 3) (4 5 6 7) (8 9 10 11) (12 13 14 15) (16 17))
```


## å¹³å¦ãª(flatten)ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ {#73703ab1-db85-48f1-8ba5-32966e9b446d}

å¹³å¦ãªã¨ã¯flatten ã¨ã„ã†è‹±èªã§ã‚ˆãç™»å ´ã™ã‚‹.

Clojureã®é–¢æ•°ã‚‚ã‚ã‚‹ => [flatten - clojure.core ClojureDocs](https://clojuredocs.org/clojure.core/flatten)

ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã‚„associateveãªæ§‹é€ ã‚’ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«ã«å‡¦ç†ã—ãŸã„ã¨ãã«ã¤ã‹ã†. ã¨ã„ã„ã¤ã¤è‡ªåŠ›ã¦ã†ã¾ã„ã¦ã‚’æ€ã„ã¤ãã®ã‚‚ã‚³ãƒ„ãŒå¿…è¦ãªã®ã§çµå±€idiomã‚’è¦šãˆã¦ã„ãã®ãŒã„ã„. ã¨ã„ã†ã“ã¨ã§ã“ã“ã«ã¾ã¨ã‚ã‚‹.


### Map => flatten sequence => Map {#34a649}

apply & concatã§flattenãªã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¤‰æ›. flattenã‚’ç›´æ¥ã¤ã‹ã†ã¨ãƒã‚¹ãƒˆã—ãŸäºŒéšå±¤ç›®ä»¥é™ã‚‚å…¨ã¦ãƒ•ãƒ©ãƒƒãƒˆã«ã—ã¦ã—ã¾ã†.

```clojure
(apply concat {:a "foo" :b "bar"})
;;=> (:a "foo" :b "bar")
```

Mapã«æˆ»ã™ã®ã¯ [into {} (map (juxt identity f))](#190de2dc-7882-46c0-b1e2-4e4999bcb2cc).


## ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®åˆ†é›¢ã¨åˆæµãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ {#f3e035f4-a23e-435d-a1e3-903e33dc9d49}

map, filter, reduceã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¯¾ã—ã¦ä¸€ã¤ã®é–¢æ•°ã‚’é©ç”¨ã—ã¦ã„ã. ã—ã‹ã—æ™‚ã«ã¯, ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¯¾ã—ã¦åˆ¥ã€…ã®é–¢æ•°ã‚’ãã‚Œãã‚Œé©ç”¨ã™ã‚‹ã“ã¨ã§ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’åˆ†é›¢ã—ãŸã„, ã¾ãŸæœ€çµ‚çš„ã«ã¯åˆ†é›¢ã—ãŸã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ãã‚Œãã‚Œå‡¦ç†ã—ãŸã‚ã¨åˆæµã•ã›ãŸã„.

éåŒæœŸå‡¦ç†ã ã¨ [pipeline](https://clojuredocs.org/clojure.core.async/pipeline) ãŒã‚ã‚‹ãŒ, ã“ã“ã§ã¯ãã“ã¾ã§ã¯è¸ã¿è¾¼ã¾ãªã„.


### juxt: è¤‡æ•°ã®é–¢æ•°ã‚’ä¸€ã¤ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«é©ç”¨ {#6fd4b9fc-acc8-4ada-bb76-ebdb4c04a7b8}

juxtãŒåˆ†é›¢ã®ãŸã‚ã®ã‚ˆã„é–¢æ•°ã¨ã—ã¦ä½¿ãˆã‚‹. juxtapositionã®ç•¥, æ—¥æœ¬èªè¨³ã ã¨ä¸¦åˆ—ã‚‰ã—ã„.

è¤‡æ•°ã®é–¢æ•°ã‚’å—å–ã‚Š, ãã‚Œã‚‰ã®é–¢æ•°ã‚’ä¸€ã¤ã®å€¤ã«é©ç”¨ã—ãŸvectorã‚’è¿”ã™. ã¾ã•ã«åˆ†é›¢ã®ãŸã‚ã®é–¢æ•°ã . ((juxt a b c) x) => [(a x) (b x) (c x)].

[juxt - clojure.core | ClojureDocs](https://clojuredocs.org/clojure.core/juxt)

(juxt f g z.. )ã®ã¿ã ã¨å˜ãªã‚‹é–¢æ•°ãªã®ã§, ã“ã®é–¢æ•°ã‚’ä»–ã¨çµ„ã¿åˆã‚ã›ã¦ã„ããƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚‚å­¦ã¶å¿…è¦ãŒã‚ã‚‹.

ãŸã¨ãˆã°mapã¨identityã‚’ä½¿ãˆã°å…ƒã®å€¤ã‚’ä¿æŒã—ã¤ã¤åˆ¥ã®å¤‰åŒ–ã‚‚ä¸¦åˆ—ã§ä¿æŒã§ãã‚‹. å¤‰æ›å‰, å¤‰æ›å¾Œã¿ãŸã„ãª.

```clojure
((juxt identity name) :keyword)
;;=> [:keyword "keyword"]
```

ã•ã‚‰ã«juxtã§å‡¦ç†ã—ãŸçµæœã¯é–¢æ•°ã”ã¨ã®ãƒªã‚¹ãƒˆã«ãªã‚‹ãªã‚‰ã°åˆ†é…æŸç¸›ã«ã‚ˆã£ã¦ãã‚Œãã‚Œã«ãƒªã‚¹ãƒˆã«åå‰ã‚’æŸç¸›ã§ãã‚‹.

```clojure
(let [[even-numbers odd-numbers :as result]
      ((juxt filter remove) even? numbers)]
  result)
```

ã‚‚ã—ãã¯mapã®é€”ä¸­ã§juxtã—ãŸæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ç„¡åé–¢æ•°ã®å¼•æ•°ã§åˆ†é…æŸç¸›ã‚’ä½¿ã£ãŸã‚Š. ä¾¿åˆ©ã !

```clojure
(->> colls
     (map (juxt #(->a %)
                #(->b %)))
     (map (fn [[a b]]
            (proc a b))))
```


### into {} (map (juxt identity f)): flattern vectorã‚’Mapã«å¤‰æ› {#190de2dc-7882-46c0-b1e2-4e4999bcb2cc}

2ã¤ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¨ã„ã†ã‚ˆã‚Šã¯, ä¸€ã¤ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ä¸­ã«key valueãŒäº¤äº’ã«ç¾ã‚Œã‚‹ã‚ˆã†ãªã‚‚ã®ã‚’mapã«å¤‰æ›ã™ã‚‹.

juxtã‚’ã¤ã‹ã†ã¨key valueã®é †ã§åˆ†é›¢ã—ãŸã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ãã‚Œã‚‰ã‚’Mapã«åˆæµã•ã›ã‚‹ã‚ˆã†ã«ã¤ã‹ã†.

```clojure
(juxt identity name)

;; ä¸Šã¯ä»¥ä¸‹ã¨åŒã˜.
(fn [x] [(identity x) (name x)])

;; ã‚ˆã£ã¦juxtã¨çµ„ã¿åˆã‚ã›ã‚Œã°Mapã«ã§ãã‚‹.
(into {} (map (juxt identity name) [:a :b :c :d]))
;;=> {:a "a" :b "b" :c "c" :d "d"}
```


### (zipmap v1 v2) =>m : è¤‡æ•°ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‹ã‚‰Mapç”Ÿæˆ {#0de7027a-daf6-4f2d-9f42-00236b432d93}

ï¼’ã¤ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‹ã‚‰Mapã‚’ç”Ÿæˆã™ã‚‹.

```clojure
(zipmap [:a :b :c :d :e] [1 2 3 4 5])
;;=> {:a 1, :b 2, :c 3, :d 4, :e 5}
```

ä¼¼ãŸã‚ˆã†ãªå‡¦ç†ã§ï¼’ã¤ã®vectorã‹ã‚‰vector listã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã‚‚æ³¨æ„.

```clojure
(map vector [:a :b :c] [:x :y :z])
;=> ([:a :x] [:b :y] [:c :z])
```


### (reduce-kv f {} m) =>m : Mapã®key-valueã«å¯¾ã—ã¦ãã‚Œãã‚Œå‡¦ç†ã—ã¦åˆæˆ {#78ca0a6b-ce34-4f69-98a3-3f34aa980435}

Mapã‚’ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¨ã—ã¦æ‰±ã†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã ãŒ, keyã«å¯¾ã™ã‚‹å‡¦ç†, valueã«å¯¾ã™ã‚‹å‡¦ç†, ãã—ã¦keyã¨valueã‚’åˆã‚ã›ãŸå‡¦ç†ãªã©, ã„ã‚ã„ã‚ã§ãã‚‹.

%1=map, %2=key, %3=valãŒbindã•ã‚Œã‚‹.

```clojure
;; keyã¨valueã‚’å…¥ã‚Œæ›¿ãˆ
(reduce-kv #(assoc %1 %3 %2) {} {:a 1 :b 2 :c 3})
;;=> {1 :a, 2 :b, 3 :c}

;; valueã‚’2å€ã®æ•°å€¤ã«ä¿®æ­£
(reduce-kv #(assoc %1 %2 (* 2 %3)) {} {:a 1 :b 2 :c 3})
;;=> {:a 2, :b 4, :c 6}
```


## é›†åˆã«ã¤ã„ã¦ {#90b81d}


### å’Œé›†åˆ {#f7feb8}

**clojure.set/union** ãŒä½¿ãˆã‚‹.

```clojure
(require '[clojure.set :refer [union]])

(union #{1 2 3} #{3 4 5})
```

ãƒªã‚¹ãƒˆã®å ´åˆã¯ï¼’ã¤ã‚’concatã§ãã£ã¤ã‘ã¦ã‹ã‚‰distinctã§ä¸€æ„ã«ã™ã‚‹.

```clojure
user> (distinct (concat '(1 2 3) '(2 3 4)))
=> (1 2 3 4)
```

intoã‚’ä½¿ã£ãŸåˆã‚ã›æŠ€ã‚‚ã‚ã‚‹.

```clojure
(into '() (into #{} (clojure.set/union '(1,2,3) '(3,4,5))))
```


### å·®é›†åˆ {#2d2ac9}

**clojure.set/difference** ã‚’ã¤ã‹ã†.

```clojure
(clojure.set/difference #{1 2 3} #{3 4 5})
```


## æ‰‹ç¶šãå‡¦ç†ã®ä¸­ã§å‡¦ç†ã‚’sleep {#d0d5b8}

Javaã®Threadã‚’ã¤ã‹ã†. msã§æŒ‡å®š.

```clojure
(Thread/sleep 5000)
```

-   ä»¥ä¸‹ã¯ä¾¿åˆ©ãªhelper function([ref](https://stackoverflow.com/questions/25733717/clojure-thread-sleep-between-map-evaluation)).

<!--listend-->

```clojure
(defn doseq-interval
  [f coll interval]
  (doseq [x coll]
    (Thread/sleep interval)
    (f x)))
```


## References {#d95867}

-   [ã‚¤ãƒ‡ã‚£ã‚ªãƒ é›† â€” Clojure ã®æ—¥æœ¬èªã‚¬ã‚¤ãƒ‰](https://ayato-p.github.io/clojure-beginner/idioms/index.html)
-   [1ãƒ¶æœˆé–“ä»•äº‹ã§Clojureã‚’æ›¸ã„ã¦ã„ã‚‹ä»Šæ™‚ç‚¹ã§ã‚ˆãä½¿ã†é–¢æ•°ãƒ»ã‚³ãƒãƒ³ãƒ‰ã¾ã¨ã‚ - Qiita](https://qiita.com/makinoshi/items/a4393784b9532d6a9f22)
-   [filter ã¨ remove ã®ãµãŸã¤ã®çµæœã‚’ç°¡å˜ã«å—ã‘å–ã‚‹æ–¹æ³• - Qiita](https://qiita.com/ayato_p/items/db4d6bd8d453f14e13e2)
-   [Clojure Destructuring Tutorial and Cheat Sheet Â· GitHub](https://gist.github.com/john2x/e1dca953548bfdfb9844)
-   [Clojureã®sequenceé–¢ä¿‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ã¾ã¨ã‚ Â· GitHub](https://gist.github.com/syou6162/3648601)
-   [ã€Clojureç‰ˆã€‘ãƒªã‚¹ãƒˆæ“ä½œã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ - Qiita](https://qiita.com/miyabisun/items/5dc3b8a5d42a8eae84d5)
