+++
title = "ğŸ“ã‚­ãƒ£ãƒƒã‚·ãƒ¥"
tags = ["WIKI"]
draft = false
+++

-   up: [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£]({{< relref "20220715090207.md#c60d1cf1-f661-4892-ab20-a249938fecb5" >}})


## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã¯ {#188be4}

Cache, Cache Archtecture.

ã‚ã‚‹é ˜åŸŸã‹ã‚‰ä»–ã®é ˜åŸŸã¸æƒ…å ±ã‚’è»¢é€ã™ã‚‹éš›, ãã®è»¢é€é…å»¶ã‚’æ¥µåŠ›éš è”½åŒ–ã•ã›è»¢é€åŠ¹ç‡ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«è€ƒæ¡ˆã•ã‚ŒãŸè¨˜æ†¶éšå±¤ã®å®Ÿç¾æ‰‹æ®µ.

-   [ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ) - Wikipedia](http://ja.wikipedia.org/wiki/%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5_(%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0))
-   [ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒª - Wikipedia](http://ja.wikipedia.org/wiki/%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%A1%E3%83%A2%E3%83%AA)

ãŸã¨ãˆã°,

-   Memory -> Cache -> CPU
-   Memory -> Cache -> HDD


## Memory Hierarchy {#0921a0}

| registers          |             |
|--------------------|-------------|
| L1 Cache           | SRAM        |
| L2 Cache           | SRAM        |
| Memory             | DRAM        |
| local 2nd storage  | local disks |
| remote 2nd storage | Web Servers |


## Locality {#4aaf3a}

å±€æ‰€æ€§.

Programs tend to use data and instructions with addresses near or equal to those they have used recently.

-   [å‚ç…§ã®å±€æ‰€æ€§ - Wikipedia](http://ja.wikipedia.org/wiki/%E5%8F%82%E7%85%A7%E3%81%AE%E5%B1%80%E6%89%80%E6%80%A7)


### æ™‚é–“çš„å±€æ‰€æ€§ (è‹±: temporal locality) {#a264b1}

ã‚ã‚‹æ™‚ç‚¹ã§å‚ç…§ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ãŒè¿‘ã„å°†æ¥ã«ã‚‚å†ã³å‚ç…§ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã“ã¨ã‚’è¡¨ã™æ¦‚å¿µ


### ç©ºé–“çš„å±€æ‰€æ€§ (è‹±: spatial locality) {#20d1f8}

ã‚ã‚‹ãƒªã‚½ãƒ¼ã‚¹ãŒå‚ç…§ã•ã‚ŒãŸã¨ã, ãã®è¿‘å‚ã®ãƒªã‚½ãƒ¼ã‚¹ãŒå‚ç…§ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã“ã¨ã‚’è¡¨ã™æ¦‚å¿µ


### é€æ¬¡çš„å±€æ‰€æ€§ (è‹±: sequential locality) {#7e8c42}

ãƒ¡ãƒ¢ãƒªãŒé€æ¬¡ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ã¨ã„ã†æ¦‚å¿µ


## Associativity {#382741}

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã¯ãƒ‡ãƒ¼ã‚¿ã‚’ Block (Line) ã¨å‘¼ã¶ã‚ã‚‹ç¨‹åº¦ã¾ã¨ã¾ã£ãŸå˜ä½ã§ç®¡ç†ã™ã‚‹. è¤‡æ•°ã‚»ãƒƒãƒˆã®ã‚¿ã‚°ã‚’æŒã¦ã°åŒã˜ã‚¨ãƒ³ãƒˆãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚‚è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã®æ ¼ç´ã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã¨ãªã‚‹. ã“ã®ã‚¿ã‚°ã®ã‚»ãƒƒãƒˆæ•° (ã‚¦ã‚¨ã‚¤) ã‚’é€£æƒ³åº¦ã¨å‘¼ã¶. ãƒ‡ãƒ¼ã‚¿æ ¼ç´æ§‹é€ ã®ç›¸é•ã¯é€£æƒ³åº¦ã®ç›¸é•ã§ã‚‚ã‚ã‚‹.


### ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒãƒƒãƒ—æ–¹å¼ (Direct Mapped) {#810742}

1 çµ„ã®ã‚¿ã‚°ã«ã‚ˆã‚Šæ§‹æˆ (é€£æƒ³åº¦ 1) ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æ ¼ç´æ§‹é€ . ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚ˆã‚Šä¸€æ„ã«é…ç½®ãŒæ±ºã¾ã‚‹ãŸã‚, ã‚¿ã‚°ã®æ§‹é€ ãŒéå¸¸ã«å˜ç´”.

ã ãŒ, åŒä¸€ã‚¨ãƒ³ãƒˆãƒªã«ç•°ãªã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè»¢é€ã•ã‚Œã‚‹ã¨å¿…ãšãƒ©ã‚¤ãƒ³ã®å…¥ã‚Œæ›¿ãˆãŒç™ºç”Ÿã™ã‚‹.

[Direct Mapped Cache](http://www.cs.umd.edu/class/sum2003/cmsc311/Notes/Memory/direct.html)


### ã‚»ãƒƒãƒˆã‚¢ã‚½ã‚·ã‚¢ãƒ†ã‚£ãƒ–æ–¹å¼ (Set Associative) {#ade231}

è¤‡æ•°ã®ã‚¿ã‚°ã«ã‚ˆã‚Šæ§‹æˆ (é€£æƒ³åº¦ 2 ä»¥ä¸Š) ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æ ¼ç´æ§‹é€ .

åŒä¸€ã‚¨ãƒ³ãƒˆãƒªã«ç•°ãªã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°æ ¼ç´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹. é€£æƒ³åº¦ãŒä¸ŠãŒã‚‹ã»ã©ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã¯ä¸Šæ˜‡ã™ã‚‹ãŒè£½é€ ã¯å›°é›£ã«ãªã£ã¦ã„ããŸã‚, ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šãƒãƒ©ãƒ³ã‚¹ã®ã‚ˆã„å®Ÿè£…ãŒç•°ãªã‚‹.

[Set Associative Cache](http://www.cs.umd.edu/class/sum2003/cmsc311/Notes/Memory/set.html)


### ãƒ•ãƒ«ã‚¢ã‚½ã‚·ã‚¢ãƒ†ã‚£ãƒ–æ–¹å¼ (Fully Associative) {#dbbde2}

ã‚¨ãƒ³ãƒˆãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚ˆã‚‹æŒ¯ã‚Šåˆ†ã‘ã¯ãªã, å…¨ã¦ã®ãƒ©ã‚¤ãƒ³ãŒæ¤œç´¢å¯¾è±¡ã¨ãªã‚‹æ§‹é€ .
å¾“ã£ã¦é€£æƒ³åº¦ã¯ãƒ©ã‚¤ãƒ³æ•°åˆ†ã¨ãªã‚‹. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒ©ãƒƒã‚·ãƒ³ã‚°ã¯èµ·ã“ã‚Šé›£ããƒ’ãƒƒãƒˆç‡ã¯æœ€ã‚‚å„ªã‚Œã¦ã„ã‚‹ãŒ, å®Ÿè£…ã‚³ã‚¹ãƒˆã‚„è¤‡é›‘åº¦ã®é¢ã‹ã‚‰é€šå¸¸ç”¨ã„ã‚‰ã‚Œã‚‹ã“ã¨ã¯ãªã„.


## General Cache Organization {#3089ff}

Block (Line), Set ã¨ã„ã†æ¦‚å¿µã‚’è¸ã¾ãˆ, ä¸€èˆ¬çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æ§‹é€ ã¯ä»¥ä¸‹ã«ãªã‚‹.


### Cache Structure {#a4249e}

```language
     Cache size = Block size
               	x é€£æƒ³æ•° (2 ã®å€æ•°)
               	x Set æ•° (2 ã®å€æ•°)
```

| Block | .... | Block |
|-------|------|-------|
| Block | .... | Block |
| Block | .... | Block |
| Block | .... | Block |
| Block | .... | Block |


### Set Structure {#df2da2}

1 Set ã¯, Block ã®é›†åˆ.é›†åˆã® size ãŒ associativity.

|       |      |       |
|-------|------|-------|
| Block | .... | Block |


### Block Structure {#ff7c81}

-   tags ... åŒä¸€ set ã®ãªã‹ã§ä¸€ä½ã«è­˜åˆ¥ã™ã‚‹ãŸã‚ã®æƒ…å ±.
-   set index ... xxx å€‹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ yyy å€‹ã«åœ§ç¸®ã™ã‚‹ãŸã‚ã®ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ¼.
    ã“ã“ãŒä½•ãƒ“ãƒƒãƒˆã«ãªã‚‹ã‹ã¯ associativity ã®æ±ºã‚æ–¹æ¬¡ç¬¬.
-   block offset ... x bit ã‚’ 2 ã®å€æ•° bit ã«åã‚ã‚‹ãŸã‚ã® offset.
-   data  ... ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿

|      |           |              |      |
|------|-----------|--------------|------|
| tags | set index | block offset | data |

```language
     ex.) 0x1833 .... 0000...... 0011 0011
     -> 0011 ã¯ block offset ã¨ã—ã¦ä½¿ã‚ãªã„.
     -> 011 ãŒ index
```
