+++
title = "ğŸ“Clojure Scraping"
tags = ["WIKI"]
draft = false
+++

Clojureã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æŠ€è¡“ã¾ã¨ã‚.

-   up: [ğŸ“Clojure Development]({{< relref "20220211141917.md" >}})
-   refs:
    -   [ğŸ“Clojure string]({{< relref "20220428163355.md" >}})
    -   [ğŸ“Clojure Bot Development]({{< relref "20220721133610.md" >}})
        -   å®šæœŸå®Ÿè¡Œã—ã¦ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼åŒ–ã™ã‚‹è©±é¡Œã¯ã“ã£ã¡.
    -   [ğŸ·scraping]({{< relref "20211213184505.md" >}})


## Cljure Scraping Basic {#60581b}

ã„ã‚ã„ã‚ã¨ã—ã‚‰ã¹ã‚‹ã¨, HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ(http-kit or clj-http) + enliveãŒç‹é“. [enlive](https://github.com/cgrand/enlive) ã¯Clojureã«ãŠã‘ã‚‹HTML parserã®ç­†é ­. HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®Get Requestã§HTMLãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‚ã¨ã¯ã‚´ãƒªã‚´ãƒªè§£æã™ã‚Œã°ã„ã„.

ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«Clojureã‚’é¸æŠã™ã‚‹åˆ©ç‚¹ã¯,

-   Lispã¯ãã‚‚ãã‚‚parserå‡¦ç†ã«å¼·ã„.
-   REPLã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªè§£æ.
-   defaultã§ãƒ‘ãƒ©ãƒ¬ãƒ«ãªå‡¦ç†ã«é•·ã‘ã¦ã„ã‚‹.

ã¤ã¾ã‚Šãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãªãã¨ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å¼·ã„. ã„ã–ã¨ãªã‚Œã°Javaã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä½¿ãˆã‚‹([playwright]({{< relref "20211213184325.md" >}}) ã¨ã‹).

---

åŸºæœ¬çš„ã«ã¯ä»¥ä¸‹ã®æµã‚Œã .

-   urlæŒ‡å®šã§ get requestã§HTMLã®ç´ ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—.
-   enliveã§htmlãƒ‡ãƒ¼ã‚¿ã‚’HashMapã«å¤‰æ›.
-   defã§REPLã«binding(ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹).
-   ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸHashMapã«å¯¾ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’REPLã¨å¯¾è©±ã—ãªãŒã‚‰ä½œæˆ.


## enlive-html {#d8f5eea6-7989-4f56-a689-1cb5cabc6360}

ref:  [Getting started Â· cgrand/enlive Wiki](https://github.com/cgrand/enlive/wiki/Getting-started)

[enlive](https://github.com/cgrand/enlive) ã¯Clojureã«ãŠã‘ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚‹ãŒ, ãã®ä¸­ã§ã‚‚enlive-htmlãŒCSS-baseãƒ‘ãƒ¼ã‚µãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª.

```clojure
(require '[net.cgrand.enlive-html :as html])
```

**html-resource** ã§ URLã«å¯¾ã—ã¦get requestã‚’ã—ã¦bodyã‚’treeãƒ‡ãƒ¼ã‚¿(hash-maps)ã«ãƒ‘ãƒ¼ã‚¹ã—ã¦ãã‚Œã‚‹. ã‚‚ã—ãã¯, è‡ªå‰ã§http getã—ã¦bodyã‚’ **html-snipet** ã«çªã£è¾¼ã‚“ã§ã‚‚ã„.

```clojure
(html/html-resource (java.net.URL url))
```

ãã—ã¦ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯å˜ãªã‚‹Clojureã®hash-mapã«éããªã„ã®ã§ï¼Œç´ ã®Clojureé–¢æ•°ã§ã‚´ãƒªã‚´ãƒªä¸­ã‚’ã¿ã‚Œã‚‹ã‚ã‘ã . **clojure.pprint/pprint** ãªã‚“ã‹ã§REPLã«å‡ºåŠ›ã§ãã‚‹(HTMLãƒ‡ãƒ¼ã‚¿ãŒå¤§ãã„ã¨ãã¯æ³¨æ„).

enliveã«ã¯ **select** ã¨ã„ã†é–¢æ•°ãŒã‚ã‚Š, ã“ã‚Œã§CSSã‚»ãƒ¬ã‚¯ã‚¿ã‚’æŒ‡å®šã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹. **get-in** ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½.


## enlive select Idioms {#0b3daa}

enliveã®ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¾‹ã¾ã¨ã‚. [ğŸ·cljidiom]({{< relref "20220302101805.md" >}})

ref. [Enlive selectors syntax - GitHub](https://github.com/cgrand/enlive/wiki/Enlive-selectors-syntax)


### ã‚¿ã‚¤ãƒˆãƒ«å–å¾— {#e62ad7}

```clojure
;; titleå–å¾—
(html/select [:title])

;; headå–å¾—
(html/select [:head])
```


### ç‰¹å®šã®ã‚¿ã‚° {#cfc235}

å¤§æŠµ, **:hogehoge** ã§å–ã‚Œã‚‹. ãŸã¨ãˆã° videoã®ã‚ˆã†ãªã‚¿ã‚°ã¯

```clojure
(html/select [:video])
```


### nameå±æ€§å–å¾— {#eb6f75}

name="description"ã¨ã„ã†å±æ€§ã‚’ã‚‚ã¤è¦ç´ ã‚’å–å¾—.

```clojure
(html/select page [(html/attr= :name "description")])
```


### a tagã®hrefã®ä¸­èº«ã‚’å–å¾— {#9a8bf4}

:a ã§ã‚¢ã‚¯ã‚»ã‚¹. a.xxxã ã¨class:xxxã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§è¿½åŠ .

ãƒ‘ãƒ¼ã‚¹ã«å–å¾—æˆåŠŸã™ã‚‹ã¨ [:atters :href]ã«urlãŒã‚ã‚‹ã®ã§ã“ã‚Œã‚’Mapæ“ä½œã§å–å¾—ã™ã‚Œã°ã„ã„.


## References {#d95867}

-   [Web Scraping with Clojure - Abu Ashraf Masnun](https://masnun.com/2016/03/20/web-scraping-with-clojure.html)
-   [Practicalli: Web Scraping with Clojure - Scraping Hacker News](https://practical.li/blog/posts/web-scraping-with-clojure-hacking-hacker-news/)
