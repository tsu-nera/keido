+++
title = "ğŸ“Clojure é–‹ç™ºç’°å¢ƒ with Emacs"
tags = ["WIKI"]
draft = false
+++

-   tags: [ğŸ·Clojure]({{< relref "20211111225741.md" >}}) [ğŸ·Emacs]({{< relref "20220112095806.md" >}})

Clojureé–‹ç™ºç’°å¢ƒ(IDE)ã¨ã—ã¦ã®Emacsè¨­å®šã¾ã¨ã‚.

Emacsã«é™å®šã—ãªã„ã‚‚ã®ã¯åˆ¥ãƒãƒ¼ãƒˆ: [ğŸ“Clojure é–‹ç™ºç’°å¢ƒ]({{< relref "20220119063524.md" >}})


## Emacs CIDER {#emacs-cider}

<https://github.com/clojure-emacs/cider>

Emacsã§Clojureé–‹ç™ºã‚’ã™ã‚‹ã¨ãã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰.

ref: [quick reference](https://github.com/clojure-emacs/cider/blob/master/refcard/cider-refcard.pdf)


### Usage {#usage}

-   C-c l ' cider-jack-in REPLèµ·å‹• &amp; æ¥ç¶š
-   C-c C-zã§ REPL - Editoré–“ã‚’ç§»å‹•.
-   C-c C-c ã§ç¾åœ¨ã®å®šç¾©ã‚’è©•ä¾¡.
-   C-c C-e ã§ãƒ•ã‚©ãƒ¼ãƒ ã®æœ«å°¾ã®æ‰‹å‰ã‹ã‚‰è©•ä¾¡.
-   C-c M-p ã§ç¾åœ¨ã®å®šç¾©ã‚’REPLã«é€ä¿¡.
-   M-. å®šç¾©ã«ç§»å‹•.
-   C-c C-d C-d documentã‚’ã¿ã‚‹.
-   jack-inã—ã¦ã„ã‚‹çŠ¶æ…‹ã§2charãã‚‰ã„æ‰“ã¡è¾¼ã‚“ã§ C-iã§è£œå®Œå€™è£œãŒã§ã‚‹.
-   C-c M-i ã§ cider-inspectorã‚’èµ·å‹•, defã®ä¸­èº«ãŒåˆ¥ãƒãƒƒãƒ•ã‚¡ã«è¡¨ç¤ºã•ã‚Œã‚‹.
-   C-c SPC: clojure-align, alignã‚’è‡ªå‹•æ•´å½¢.
-   Evaluation
    -   M-x cider-pprint-last-eval-to-comment
        -   å¼ã®è©•ä¾¡çµæœãŒã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ›¸ã‹ã‚Œã‚‹.
        -   Design Journalã¨ã—ã¦ã¯ä¾¿åˆ©ãªæ©Ÿèƒ½ã‹ã‚‚.
        -   C-u C-x C-e ã§ã‚‚å¯èƒ½.
    -   M-x cider-pprint-defun-to-comment
        -   ã“ã‚Œã¯ãƒ•ã‚©ãƒ¼ãƒ ã®å…ˆé ­ã§è©•ä¾¡ã™ã‚‹ã¨æ¬¡ã®è¡Œã«çµæœè¡¨ç¤º.
-   cider-repl-set-ns: namespaceã‚’replã«è¨­å®š.


### cf.: clojure-lsp {#cf-dot-clojure-lsp}

åŒæ§˜ã®ãƒ„ãƒ¼ãƒ«ã§clojure-lspã¨ã„ã†
Emacsã‹ã‚‰Clojureã®LSPã‚’ä½¿ã†ãŸã‚ã®Emacs Packageã‚‚ã‚ã‚‹.
åŒã˜ã“ã¨ã¯CIDERã§ã‚‚clojure-lspã§ã‚‚ã§ãã‚‹ãŒ
clojure-lspã®ã»ã†ãŒCPUä½¿ç”¨ç‡ãŒé«˜ã„ã¨ã‹(æœªæ¤œè¨¼).


### tips: cider-jack-inã§ã‚«ã‚¹ã‚¿ãƒ ã®ä¾å­˜ã‚’è¨­å®š {#tips-cider-jack-inã§ã‚«ã‚¹ã‚¿ãƒ ã®ä¾å­˜ã‚’è¨­å®š}

ä¸€å¿œcider-jack-inã‚’ã™ã‚‹ã¨ä¾å­˜é–¢ä¿‚ã‚’ã‚ˆã‚ã—ãè§£æ±ºã—ã¦ãã‚Œã‚‹ãŒ,
productionã«å«ã‚ãªã„developmentã®ä¾å­˜é–¢ä¿‚ã¯è‡ªå‹•ã§è§£æ±ºã•ã‚Œãªã„.

.dir-locals.elã« cider-clojure-cli-global-optionsã‚„
cider-clojure-cli-aliasesã«è¿½åŠ ã®è¨­å®šã‚’æ›¸ã.

ä¾‹ãˆã°, deps.ednã®aliasã« :devã®ã‚ˆã†ãªå®šç¾©ãŒã‚ã‚Œã°,

```emacs-lisp
((clojure-mode . ((cider-clojure-cli-aliases . "dev"))))
```

ref: [Practicalli: CIDER jack-in to Clojure CLI projects from Spacemacs](https://practical.li/blog/posts/cider-jack-in-to-clojure-cli-projects-from-spacemacs/)


### tips: REPLã®å±¥æ­´ã‚’ã¤ã‹ã†(cider-repl-history) {#tips-replã®å±¥æ­´ã‚’ã¤ã‹ã†--cider-repl-history}

REPLã«å…¥åŠ›ã—ãŸãƒ•ã‚©ãƒ¼ãƒ ã¯M-pã§é¡ã‚‹ã“ã¨ãŒã§ãã‚‹.
ã¾ãŸ C-c M-p(cider-repl-history)ã§éå»ã®å±¥æ­´ã‚’ãƒªã‚¹ãƒˆè¡¨ç¤ºã§ãã‚‹.


### tips: å¤‰æ•°å®šç¾©ã®ä¸­èº«ã‚’ã¿ã‚‹(cider-inspect) {#tips-å¤‰æ•°å®šç¾©ã®ä¸­èº«ã‚’ã¿ã‚‹--cider-inspect}

C-c C-eã§ãƒ•ã‚©ãƒ¼ãƒ ã‚’è©•ä¾¡ã—ã¦ä¸­èº«ã‚’ã¿ã‚‹ã®ã‚‚ã„ã„ãŒ,
ciderã«ã¯ cider-inspectã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚‹.

ã“ã‚Œã‚’èª¿ã¹ãŸã„å¤‰æ•°ã®ä¸Šã§å®Ÿè¡Œ(C-c M-i)ã™ã‚‹ã¨,
åˆ¥ãƒãƒƒãƒ•ã‚¡ã«ä¸­èº«ãŒè¡¨ç¤ºã•ã‚Œã‚‹.


### tips: cider-clojuredocsã®æ´»ç”¨ {#tips-cider-clojuredocsã®æ´»ç”¨}

cider-clojuredocsã‚’ã™ã‚‹ã¨åˆ¥ãƒãƒƒãƒ•ã‚¡ã§ [clojuredocs](https://clojuredocs.org) å†…ã®é–¢æ•°å®šç¾©ã‚’å‚ç…§ã§ãã‚‹.

Clojureã®åˆå­¦ã§ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’Googleã§æ¤œç´¢ã™ã‚‹ã“ã¨ãŒå¤šã„.
cider-clojuredocsã‚’ã¤ã‹ã†ç¿’æ…£ã‚’å¿ƒãŒã‘ã‚‹ã“ã¨ã§, ãƒãƒ¼ã‚¸ãƒ³æ™‚é–“ã®å‰Šæ¸›ã«ã¤ãªãŒã‚‹.


### tips: cider-connectã§ã®portå›ºå®š {#tips-cider-connectã§ã®portå›ºå®š}

å›ºå®šãƒãƒ¼ãƒˆè‡ªä½“ã¯nREPLã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰æŒ‡å®š.

```clojure
:main-opts ["-m" "nrepl.cmdline"
            "-b" "0.0.0.0"
            "-p" "12345"
            "--middleware" "[cider.nrepl/cider-middleware,refactor-nrepl.middleware/wrap-refactor]"]
```

cider-connectã®æ¥ç¶šå…ˆã®å€™è£œã«å›ºå®šã—ãŸportã‚’è¡¨ç¤ºã™ã‚‹([ref](https://nrepl.org/nrepl/usage/server.html#using-clojure-cli-tools)).

```emacs-lisp
(setq cider-known-endpoints '(("localhost" "0.0.0.0" "12345")))
```


## Emacs smartparens {#emacs-smartparens}

<https://github.com/Fuco1/smartparens>

Emacsã§Så¼ã‚’æ“ä½œã™ã‚‹.

pareditã‚ˆã‚Šã‚‚smartparensã®ã»ã†ãŒæœ€è¿‘ç™»å ´ã—ãŸã‚ˆã†ãªã®ã§ã“ã¡ã‚‰ã‚’ã¤ã‹ã†.

[doom emacsã® defaultè¨­å®š](https://github.com/hlissner/doom-emacs/blob/master/modules/config/default/%2Bemacs-bindings.el)

-   (, [, {ãªã©ã§è‡ªå‹•ã§é–‰ã˜ã‚«ãƒƒã‚³ãŒæŒ¿å…¥ã•ã‚Œã‚‹.
-   block movement
    -   ()ã®ä¸­ã§)ã‚’å…¥åŠ›ã™ã‚‹ã¨ï¼Œç¾åœ¨ã®)ã®æœ«å°¾ã«é£›ã¶.
    -   []ã®ä¸­ã§]ã‚’å…¥åŠ›ã™ã‚‹ã¨ï¼Œç¾åœ¨ã®]ã®æœ«å°¾ã«é£›ã¶.
-   Navigation
    -   C-M-a: sp-beggining-of-sexp ç¾åœ¨ã®Så¼ã®å…ˆé ­ã¸ç§»å‹•.
    -   C-M-e: sp-end-of-sexpç¾åœ¨ã®Så¼ã®æœ«å°¾ã¸ç§»å‹•.
    -   C-M-f: sp-forward-sexp æ¬¡ã®Så¼ã«ç§»å‹•
    -   C-M-b: sp-backward-sexp å‰ã®Så¼ã«ç§»å‹•
    -   C-M-n: sp-next-sexp
    -   C-M-p: sp-previous-sexp
    -   C-M-u: sp-up-sexp ç¾åœ¨ã®Så¼ã®ã²ã¨ã¤å¤–å´ã®Så¼ã®æœ«å°¾ã¸ç§»å‹•.
    -   C-M-d: sp-donw-sexp ç¾åœ¨ã®Så¼ã®ã²ã¨ã¤å†…å´ã®Så¼ã®å…ˆé ­ã¸ç§»å‹•.
    -   C-M-k: sp-kill-sexp ç¾åœ¨ã®Så¼ã®å†…å´ã‚’å‰Šé™¤.
    -   C-M-t: sp-transpose-sexp
-   wrapping/unwrapping
    -   C-M-Spaceã§ç¾åœ¨ã®éƒ¨åˆ†ã‹ã‚‰wordã®æœ«å°¾ã¾ã§ã‚’ãƒãƒ¼ã‚¯.
        -   (ã¨ã‹[ã§ãƒãƒ¼ã‚¯ã—ãŸéƒ¨åˆ†ã‚’å›²ã‚€.
    -   C-M-&lt;backspace&gt;: sp-splice-sexp
        -   ç¾åœ¨ã®éƒ¨åˆ†ã®å‰ã®Så¼ã‚‚ã‚ã¨ã‚‚å‰Šé™¤.

ã“ã®ï¼•ã¤ã‚’è¦šãˆã‚‹ã ã‘ã§ã€ä½œæ¥­åŠ¹ç‡ãŒä¸ŠãŒã‚ŠãŠã™ã™ã‚ã•ã‚Œã¦ã„ã‚‹.

-   Slurp ï¼ˆéš£ã®æ‹¬å¼§ã‚’å¸ã„è¾¼ã‚€ï¼‰
-   Barf ï¼ˆæ‹¬å¼§ã‚’è¿½ã„å‡ºã™ï¼‰
-   ã‚«ãƒƒãƒˆ ï¼ˆæ‹¬å¼§å˜ä½ã§ã®ã‚«ãƒƒãƒˆï¼‰
-   ã‚³ãƒ”ãƒ¼ ï¼ˆæ‹¬å¼§å˜ä½ã§ã®ã‚³ãƒ”ãƒ¼ï¼‰
-   å‰Šé™¤ ï¼ˆæ‹¬å¼§ã‚’ä¸¸ã”ã¨æ¶ˆã™ï¼‰

ref: [ã„ã¾ã©ãã®Clojureã®ã¯ã˜ã‚ã‹ãŸ - ç´™ç®±](https://boxofpapers.hatenablog.com/entry/2018/10/06/210602)

refs:

-   <https://github.com/Fuco1/smartparens>
-   <https://ebzzry.com/en/emacs-pairs/>
-   <http://kimi.im/2021-11-27-sexp-operations-in-emacs>


## Doom Emacs Clojure Module {#doom-emacs-clojure-module}

[hlissner/doom-emacs Â· GitHub](https://github.com/hlissner/doom-emacs/blob/master/modules/lang/clojure/README.org)

ä»¥ä¸‹ã®3ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã“æ¢±åŒ…ã•ã‚Œã¦ã„ã‚‹.

-   cider
-   clj-refactor
-   flycheck-clj-kondo


## Clojure: æ–‡èŠ¸çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° with org-babel {#clojure-æ–‡èŠ¸çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°-with-org-babel}

org-modeã®ãƒãƒ¼ãƒˆä¸Šã‹ã‚‰REPLã«jack-inã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’è©•ä¾¡.
ã™ãªã‚ã¡, [Design Journal]({{< relref "20220117205249.md#design-journal" >}}) ã‚’ org-modeã‹ã‚‰å®Ÿæ–½ã™ã‚‹
(aka. Literature Programming).

-   refs.
    -   [ğŸ·org-babel]({{< relref "20211211071525.md#org-babel" >}})
    -   [ğŸ·Literate Programming]({{< relref "20220318202503.md" >}})
    -   <https://github.com/tkf/org-mode/blob/master/lisp/ob-clojure.el>
    -   [ğŸ–ŠClojure REPLé§†å‹•é–‹ç™ºã¨org-babelã«ã‚ˆã‚‹æ–‡èŠ¸çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å†ç™ºè¦‹ | Futurismo](https://futurismo.biz/clojure-literate-programming-with-org-babel/)


### header options {#header-options}

-   begin_src clojureã‚’æŒ‡å®šã—ã¦org-babelã«clojureã‚’è¨­å®š.
-   :results ppã‚’ã™ã‚‹ã“ã¨ã§çµæœã‚’pretty print
    -   valueã¨ã„ã†è©•ä¾¡çµæœã‚’è¡¨ç¤ºã™ã‚‹æŒ‡å®šã¯defaultã®ãŸã‚çœç•¥ã•ã‚Œã¦ã„ã‚‹.
-   :ns fooã‚’å®£è¨€ã™ã‚‹ã¨, èµ·å‹•æ™‚ã®namespaceã‚’è¨­å®šã§ãã‚‹.
    -   resultã¯æŒ‡å®šã—ãŸ nsã«bindã•ã‚Œã‚‹.

<!--listend-->

```text
#+begin_src clojure :results pp
(require '[lib.twitter.guest :as guest])
(guest/get-user "richhickey")
#+end_src
```


### org-babelå®Ÿè¡Œ {#org-babelå®Ÿè¡Œ}

-   ã¾ãšäº‹å‰ã«REPLã‚’ç«‹ã¡ä¸Šã’ã¦ãŠã.
-   C-c C-c ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚³ãƒ¼ãƒ‰ã‚’è©•ä¾¡.
    -   cider-jack-in or cider-connectã®é¸æŠã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹.
    -   äº‹å‰ã«ç«‹ã¡ä¸Šã’ã¦ãŠã„ãŸREPLã«cider-connect


### tips: org-modeã§clojureã‚³ãƒ¼ãƒ‰ã‚’è©•ä¾¡ {#tips-org-modeã§clojureã‚³ãƒ¼ãƒ‰ã‚’è©•ä¾¡}

é€šå¸¸ã¯ M-x org-edit-src-codeã§ã‚³ãƒ¼ãƒ‰ç·¨é›†ã ãŒ,
org-modeã‹ã‚‰ç·¨é›†ã™ã‚‹Tips.

org-babel ã§ å®Ÿè¡Œã—ãŸã„è¨€èªã¨ã—ã¦clojureã‚’enable.
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ emacs-lisp ã ã‘.

```emacs-lisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((lisp . t)
     (shell . t)
     (clojure . t)))
```

ã“ã‚Œã§ code blockã«é–¢ã‚ã‚‰ãšclojureãŒã‹ã‘ã‚‹.
è©•ä¾¡ã¯org-modeã§ã¯C-x C-eãŒemacs-lispã®è©•ä¾¡ã«å–ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§,
åˆ¥ã®keybindã‚’è¨­å®šã™ã‚‹.

```emacs-lisp
(org-defkey org-mode-map "\C-u\C-x\C-e" 'cider-eval-last-sexp)
```


## References {#references}

-   ğŸ”—[Spacemacsã§Clojureã‚’æ›¸ããŸã‚ã«åƒ•ãŒè¡Œã£ãŸè¨­å®š - ayato-p](https://scrapbox.io/ayato-p/Spacemacs%E3%81%A7Clojure%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%9F%E3%82%81%E3%81%AB%E5%83%95%E3%81%8C%E8%A1%8C%E3%81%A3%E3%81%9F%E8%A8%AD%E5%AE%9A)
-   æ˜”ã®ã‚ãŸã—ã®è¨˜äº‹ï¼Œã‚‚ã†æƒ…å ±ãŒå¤ã„(2016)
    -   [ğŸ–ŠEmacs ã§ Clojure ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ | Futurismo](https://futurismo.biz/archives/5742/)
