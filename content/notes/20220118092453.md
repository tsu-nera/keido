+++
title = "ğŸ“Clojure Web Development"
tags = ["WIKI"]
draft = false
+++

Clojureã«ã‚ˆã‚‹Webé–‹ç™ºãƒã‚¦ãƒã‚¦ã¾ã¨ã‚.

tags: [ğŸ·Clojure]({{<relref "20211111225741.md#" >}}) [ğŸ·Web Development]({{<relref "20220220094636.md#" >}})

ãƒ†ãƒ¼ãƒãŒå¤§ãã„ã®ã§åˆ†å‰²ã™ã‚‹ã‹ã‚‚.


## Clojure: Ring {#clojure-ring}

<https://github.com/ring-clojure/ring>

Clojureã«ãŠã‘ã‚‹Web Server Abstructionã®ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰.

-   [Why Use Ring? Â· ring-clojure/ring Wiki Â· GitHub](https://github.com/ring-clojure/ring/wiki/Why-Use-Ring%3F)
    -   ãªãœRingã‚’ã¤ã‹ã†ã®ã‹ï¼Ÿ
        -   Webã‚¢ãƒ—ãƒªã‚’Clojureã®é–¢æ•°ã¨Mapãƒ‡ãƒ¼ã‚¿ã®ã¿ã§æ§‹ç¯‰ã™ã‚‹ã¨ã„ã†è¨­è¨ˆæ¦‚å¿µã‚’ç¤ºã™.
        -   Java servletã®ä¸Šã§èµ°ã‚‹ã‚¢ãƒ—ãƒªã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹.
-   4ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ãªã‚‹([ref](https://github.com/ring-clojure/ring/wiki/)).
    -   Handler
        -   Clojureã®é–¢æ•°ã§è¡¨ç¾ã•ã‚Œã‚‹.
        -   Request Mapã‚’å—å–ã‚Š, Response Mapã‚’è¿”ã™.
    -   Request
    -   Response
    -   Middleware

ref: [ğŸ·Web Server Interface]({{<relref "20220220095102.md#web-server-interface" >}})


### References {#references}

-   [clojure-ring - é–‹ç™ºè€…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://ja.getdocs.org/clojure-ring/)
-   [Part2: Ring ã«ã¤ã„ã¦çŸ¥ã‚‹ â€” Clojure ã®æ—¥æœ¬èªã‚¬ã‚¤ãƒ‰](https://ayato-p.github.io/clojure-beginner/intro%5Fweb%5Fdevelopment/part2%5Fwhat%5Fis%5Fring.html)
    -   ã‚ã‚„ã¨ã´ã•ã‚“ã®Web é–‹ç™ºãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«.
-   [Clojureã®Webé–‹ç™ºã§ã‚‚ã£ã¨ã‚‚é‡è¦ãªRing Handlerã«ã¤ã„ã¦ç†è§£ã™ã‚‹ - TOYOKUMO](https://tech.toyokumo.co.jp/entry/2019/07/03/122656)
    -   ãƒˆãƒ¨ã‚¯ãƒ¢ã®æ–°å’ã‚„ã‚¢ãƒ«ãƒã‚¤ãƒˆå­¦ç”Ÿã®ãŸã‚ã®æ•™è‚²ç”¨Ringè§£èª¬è¨˜äº‹.


### Active Recalls {#active-recalls}


#### Clojure Ring ã«ãŠã‘ã‚‹4ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãªã‚“ã§ã™ã‹ï¼Ÿ {#clojure-ring-ã«ãŠã‘ã‚‹4ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãªã‚“ã§ã™ã‹}

ãƒãƒ³ãƒ‰ãƒ©ãƒ¼, ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢, ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒƒãƒ—, ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒãƒƒãƒ—.


## Heroku with Clojure {#heroku-with-clojure}

-   <https://devcenter.heroku.com/articles/deploying-clojure>
    -   ja: <https://devcenter.heroku.com/ja/articles/deploying-clojure>
-   <https://devcenter.heroku.com/articles/getting-started-with-clojure>
    -   ja: <https://devcenter.heroku.com/ja/articles/getting-started-with-clojure>
-   <https://devcenter.heroku.com/articles/clojure-support>
    -   ja: <https://devcenter.heroku.com/ja/articles/clojure-support>

leiningenã®ä½œè€…ãŒHerokuã§åƒã„ã¦ãŸã‚‰ã—ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã¦ã„ã­ã„ã¨ã‹.

<https://twitter.com/as%5Fchapa/status/1198104444711256064>
<https://twitter.com/iku000888/status/1099293410693808128>


### tip: Herokuä¸Šã®appã«replã§æ¥ç¶š {#tip-herokuä¸Šã®appã«replã§æ¥ç¶š}

heroku run lein replã§Herokuã‚µãƒ¼ãƒä¸Šã§replã‚’èµ·å‹•ã§ãã‚‹.

> heroku run lein repl


### howto: Heroku Deployã§lein depså¤±æ•—ã®å¯¾å‡¦æ–¹æ³• {#howto-heroku-deployã§lein-depså¤±æ•—ã®å¯¾å‡¦æ–¹æ³•}

> Leiningen 1.7.1 ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ç”¨ã•ã‚Œã¾ã™ãŒã€project.clj ã« :min-lein-version
"2.0.0"â€‹ ãŒã‚ã‚‹å ´åˆã¯ (å¼·ãæ¨å¥¨ã•ã‚Œã¾ã™)ã€Leiningen 2.9.1 ãƒªãƒªãƒ¼ã‚¹ãŒä»£ã‚ã‚Šã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã«ãƒãƒã£ãŸ. project.cljã« :min-lein-version "2.0.0" ã‚’è¨˜è¼‰ã—ã¦è§£æ±ºâœ¨

ref: <https://devcenter.heroku.com/ja/articles/clojure-support>


### howto: Herokuä¸Šã§ Botã‚’å‹•ã‹ãã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ {#howto-herokuä¸Šã§-botã‚’å‹•ã‹ãã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼}

web appã§ã¯ãªã worker appã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹.

ãã†ã—ãªã„ã¨ 60secã§BootTimeoutã¨ã—ã¦æ‰±ã‚ã‚Œã¦Process Killã•ã‚Œã‚‹.

```text
2022-02-11T09:30:12.486217+00:00 heroku[web.1]: Error R10 (Boot timeout) -> Web process failed to bind to $PORT within 60 seconds of launch
2022-02-11T09:30:12.581863+00:00 heroku[web.1]: Stopping process with SIGKILL
2022-02-11T09:30:12.834345+00:00 heroku[web.1]: Process exited with status 137
2022-02-11T09:30:13.225734+00:00 heroku[web.1]: State changed from starting to crashed
```

Procfileã‚’æ–°è¦ä½œæˆã—ã¦ä»¥ä¸‹ã‚’è¨˜è¼‰.

> worker: lein run

heroku cliã‚ˆã‚Š

> heroku ps:scale worker=1

ãŸã ã— workerã¯30åˆ†æ´»å‹•ãŒãªã„ã¨sleepã—ã¦ã—ã¾ã†.

å®Ÿéš›ã¯heroku schedulerã®æ´»ç”¨ã‚‚æ¤œè¨.


## Firebase/Google Cloud w/ Clojure {#firebase-google-cloud-w-clojure}

[ğŸ·Firebase]({{<relref "20220215183442.md#" >}})

ref: <https://github.com/tsu-nera/meigen-bot-firebase-clj>


### Firebase Firestore(aka. Google Cloud Firestore)  w/ Clojure {#firebase-firestore--aka-dot-google-cloud-firestore--w-clojure}

ã›ã£ã‹ãã®Clojureãªã®ã§Clojure onlyã§é ‘å¼µã‚‰ãšã«Javaã‚„node.jsã®è³‡ç”£ã‚’æ´»ç”¨ã™ã‚‹æ–¹å‘ãŒã„ã„ã‹ãª...Javaè³‡ç”£æ´»ç”¨ã—ãªã„ã¨ãƒªãƒƒãƒãƒ¼ãƒ’ãƒƒã‚­ãƒ¼ã®é–‹ç™ºãƒ¢ãƒãƒ™ã«åã™ã‚‹ğŸ¤”

-   [Add the Firebase Admin SDK to your server Â |Â  Firebase Documentation](https://firebase.google.com/docs/admin/setup/)
-   [Get started with Cloud Firestore Â |Â  Firebase Documentation](https://firebase.google.com/docs/firestore/quickstart)


### Firebase Functions(aka. Google Cloud Functions) w/ Clojure {#firebase-functions--aka-dot-google-cloud-functions--w-clojure}

ClojureScriptã‚’åˆ©ç”¨ã—ã¦JavaScript(Node.js)ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã®ãŒã‚ˆã„.

-   [ClojureScript + Firebase - DEV Community](https://dev.to/kbaba1001/clojurescript-firebase-3a26)
    -   ref: <https://twitter.com/kbaba1001/status/1342628846655324160>
-   [My PWA made with Clojure/ClojureScript exceeded 400 users ğŸ‰ - DEV Community](https://dev.to/boxp/my-pwa-made-with-clojure-clojurescript-exceeded-400-users-5co7)
    -   ref: <https://twitter.com/b0xp2/status/1259685025122930689>

ã—ã‹ã—Clojureã®é“ã«æŒ‘æˆ¦ã—ã¦ã—ã¾ã£ãŸ...åœ°é›·ã ã‚‰ã‘.

åŸºæœ¬æ–¹é‡ã¨ã—ã¦ã¯, Google Cluud Functionsã®Java11ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãƒšãƒ¼ã‚¸ã‚’ã¿ãªãŒã‚‰,
functions-framework-java ã‚’åˆ©ç”¨ã™ã‚‹.

-   <https://cloud.google.com/functions/docs/concepts/java-runtime>
-   <https://github.com/GoogleCloudPlatform/functions-framework-java>

2022.01æ™‚ç‚¹ã§ã®æ³¨æ„ç‚¹ã¨ã—ã¦ã¯,

-   ä»–ã®JVMè¨€èªã®ã¨ã“ã‚ã«ClojureãŒç™»å ´ã—ãªã„.
    -   <https://cloud.google.com/functions/docs/concepts/jvm-langs>
    -   Scala, Kotlin, Groovyã¯ç™»å ´ã™ã‚‹.
    -   ä»–ã®JVMè¨€èªã‚’çœŸä¼¼ã—ã¦Clojureã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã¨,ã‚¨ãƒ©ãƒ¼.
-   ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼ã¯ï¼’ã¤ã‚ã‚‹ãŒãŠãã‚‰ããƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ã§ãªã„ã¨å¤±æ•—.
    -   <https://cloud.google.com/functions/docs/concepts/java-deploy>
    -   ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯pom.xmlã¨ã‚½ãƒ¼ã‚¹ã®uploadã¯æˆåŠŸã™ã‚‹ãŒclojureã®ãƒ“ãƒ«ãƒ‰ã§ã‚³ã‚±ã‚‹. ãã‚‚ãã‚‚Cloud Functionsã§ä½¿ã‚ã‚Œã¦ã„ã‚‹Cloud Bulildã§Clojureã®ãƒ“ãƒ«ãƒ‰ã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã‹æ€ªã—ã„. ClojureCoreãã®ä»–ã¯ã¯defaultã§Java8ã§ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ã‚‹.
        ä¸€æ–¹Cloud Functionsã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯11.
    -   ã—ãŸãŒã£ã¦uberjar(fatjar)ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½œæˆã—ã¦.classãƒ•ã‚¡ã‚¤ãƒ«ã¨ä¸€ç·’ã«uploadã™ã‚‹ã®ãŒã„ã„.
-   ä»¥ä¸‹ã®3ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªãŒå‚è€ƒã«ãªã‚‹.
    -   <https://github.com/pepijn/google-cloud-functions-clojure>
    -   <https://pathom3.wsscode.com/docs/tutorials/serverless-pathom-gcf/#gcf-deploy>
    -   <https://github.com/atomist-skills/gcf-java11-clojure>
-   ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆã¯ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’Javaã§ç”¨æ„ã™ã‚‹ã¨ã“ã‚.
    -   Clojureã§ç”¨æ„ã—ã‚ˆã†ã¨ã—ã¦ã‚‚ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã™ã‚‹.
-   uberjarã®ãƒ“ãƒ«ãƒ‰ã«ã¯tools.buildã®guideã‚’ã¿ã¦,
    Javaã‚½ãƒ¼ã‚¹ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦Clojureã‚³ãƒ¼ãƒ‰ã‚’uberjarã§.jarãƒ•ã‚¡ã‚¤ãƒ«ã«å«ã‚ã‚‹.
    -   <https://clojure.org/guides/tools%5Fbuild>


### Google Cloud Run w/ Clojure {#google-cloud-run-w-clojure}

-   [Clojure in Google Cloud Run with Jib â€“Â Hannu Hartikainen](https://hannuhartikainen.fi/blog/clojure-cloud-run/)
-   [Clojure app on Google Cloud Run | 3sky's notes](https://blog.3sky.dev/article/google-run-clojure/)
-   [Google Cloud Run ã§ Clojure ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã‚ˆã† | Micheam's TechBlog](https://blog.micheam.com/2019/12/12/how-to-run-clojure-on-google-cloud-run/)

jibã‚’åˆ©ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ“ãƒ«ãƒ‰ã™ã‚‹.
å®Ÿéš›ã«æ¤œè¨¼ã—ãŸæ„Ÿè§¦ã§ã¯Cloud Functionsã‚ˆã‚Šã‚‚åœ§å€’çš„ã«æ¥½.

ref: <https://github.com/tsu-nera/meigen-bot-gcloud-run-clj>


## References {#references}

-   ğŸ”—[ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã¨ã¯ã¾ã£ãŸãé•ã†Clojureã®ä¸–ç•Œã¨å®Ÿéš›ã®Webé–‹ç™º - ç´™ç®±](https://boxofpapers.hatenablog.com/entry/2018/06/24/160802)
-   ğŸ”—[Clojure ã§ Web é–‹ç™ºã‚’ã¯ã˜ã‚ã¦ã¿ã‚ˆã† â€” Clojure ã®æ—¥æœ¬èªã‚¬ã‚¤ãƒ‰](http://ayato-p.github.io/clojure-beginner/intro%5Fweb%5Fdevelopment/index.html)
-   [ğŸ”—Clojure x ClojureScript ã§æ·±ã‚ã‚‹ Web é–‹ç™º - Qiita](https://qiita.com/MeguruMokke/items/c6e059f109122be5f991)
    -   <https://github.com/MokkeMeguru/clj-web-dev-ja>
    -   <https://github.com/MokkeMeguru/portcard-api>
-   <http://ayato-p.github.io/clojure-beginner/intro%5Fweb%5Fdevelopment/index.html>
    -   ayato-pã•ã‚“ã®ä½œ.
        -   ãŸã—ã‹ã‚ãŸã—ãŒClojureã«ã¯ã˜ã‚ã¦è§¦ã‚ŒãŸ2015ã”ã‚ã«ã¯ã™ã§ã«ã‚ã£ãŸæ°—ãŒã™ã‚‹.
