+++
title = "ğŸ“Clojure:åå‰ç©ºé–“ã¨å¤‰æ•°æŸç¸›(Bindings and Namespaces)"
tags = ["WIKI"]
draft = false
+++

Clojureã§ã¯ï¼Œå¤‰æ•°ã®åå‰ç©ºé–“ã¨æŸç¸›ã®é–¢ä¿‚ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹.

ref: [ğŸ“‚Clojure Core]({{< relref "20220112142936.md" >}})


## Clojure: åå‰ç©ºé–“(Namespaces) {#clojure-åå‰ç©ºé–“--namespaces}

Clojure ã®åå‰ç©ºé–“ã‚’ namespaceã¨ã„ã†. ns ã§å®£è¨€ã™ã‚‹. \\\*ns\\\* ã§å‚ç…§ã™ã‚‹.

ã‚ã‚‹åå‰ç©ºé–“ã‹ã‚‰åˆ¥ã®åå‰ç©ºé–“ã‚’å‚ç…§ã™ã‚‹ã«ã¯ requireã‚’ã¤ã‹ã†.

-   require ã®ã¿ çœç•¥ãªã—ã®è¡¨è¨˜ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹(namespace/symbols)
-   require :as çœç•¥ã—ãŸè¡¨è¨˜ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹(çœç•¥namesapce/symbols)
-   require :refer :all åå‰ç©ºé–“ã‚’æ›¸ã‹ãªã„è¡¨è¨˜ã§ã‚·ãƒ³ãƒœãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹(symbols)

[ğŸ·environments]({{< relref "20220305075933.md#valuables-å¤‰æ•°" >}})


### Clojure: åå‰ç©ºé–“ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ {#clojure-åå‰ç©ºé–“ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰}

[ğŸ·Clojure Style Guide]({{< relref "20220313110515.md#clojure-ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰" >}})

[Clojureã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰](https://totakke.github.io/clojure-style-guide/) ã‚ˆã‚Šåå‰ç©ºé–“ã«é–¢ã‚ã‚‹éƒ¨åˆ†ã‚’æŠœãå‡ºã—

-   åå‰ç©ºé–“ã¯1ãƒ•ã‚¡ã‚¤ãƒ«ã«ï¼‘ã¤.
-   åå‰ç©ºé–“ã®å‘½åè¦ç´„ã¯kebab-case(lisp-case).
-   æ·±ã„åå‰ç©ºé–“ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¯æ‚ªã„(ã›ã„ãœã„5ã¤ã¾ã§).

ã¾ãŸ. library-name.coreã¿ãŸã„ãªã®ã¯Leiningen Projectã®æ…£ç¿’.

åå‰ç©ºé–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã¤ã„ã¦.

-   refer, require, importã®é †ã«ä¸¦ã¹ã‚‹.
-   é©åˆ‡ãªæ”¹è¡Œ.
-   requireã¨importã‚’æ•´ç†ã—ã¦ä¸¦ã¹ã‚‹.
-   Idiomatic ãªåå‰ç©ºé–“ã®åå‰ã‚’ã¤ã‹ã†.
    -   å…·ä½“ä¾‹ã¯ä»¥ä¸‹ã«ã„ã‚ã„ã‚æ›¸ã„ã¦ã‚ã‚‹. (io, set, pp, etc..).
    -   [Use Idiomatic Namespace Aliases -  bbatsov/clojure-style-guide](https://github.com/bbatsov/clojure-style-guide/blob/master/README.adoc#use-idiomatic-namespace-aliases)
    -   è¦ã¯é•·ã„åå‰ã‚’ä½¿ã†ã®ã§ã¯ãªãã¦çœç•¥ã—ã¾ã—ã‚‡ã†ã¨ã„ã†ã“ã¨.

ã“ã‚Œã‚‰ã¯äººé–“ãŒæ„è­˜ã™ã‚‹ã¹ãã§ã¯ãªã„ã®ã§ãƒ„ãƒ¼ãƒ«ã«ä»»ã›ãŸã„ã¨ã“ã‚ã .
Emacs CIDERãªã‚‰ cljr-clean-ns or clojure-sort-ns.


### Clojure: Scope {#clojure-scope}

Clojureã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§é™çš„ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹.

[ğŸ·Scope]({{< relref "20220305075933.md#scope-ã‚¹ã‚³ãƒ¼ãƒ—" >}})


#### Dynamic Scope {#dynamic-scope}

å‹•çš„ã‚¹ã‚³ãƒ¼ãƒ—. Emacsãªã‚‰å¸¸è­˜ã‹.

Clojureã®Dynamic Scopeã¯ **bindings** ãƒã‚¯ãƒ­ã§å®šç¾©ã™ã‚‹.
åå‰ç©ºé–“ã‚’è¶…ãˆã¦, åŒä¸€ã‚¹ãƒ¬ãƒƒãƒ‰å†…ãªã‚‰å€¤(var)ãŒå‚ç…§å¯èƒ½.

Lispã®æ…£ä¾‹ã¨ã—ã¦, ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯(\*)ã§symbolã‚’å›²ã‚€.

ãã†ã„ã†æ„å‘³ã ã¨, ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ­ãƒ¼ã‚«ãƒ«ã¨ã„ãˆã‚‹ã‹ã‚‚.
ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ã¾ãŸãæ–¹æ³•ã¯ã¾ãŸåˆ¥ã«ã‚ã‚‹?
(æœªèª¿æŸ», keyword: "binding conveyance").

refs: [Clojure - Vars and the Global Environment](https://clojure.org/reference/vars)


### howto: namespaceã«bindingsã•ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ã‚’ç¢ºèªã™ã‚‹ã«ã¯ï¼Ÿ {#howto-namespaceã«bindingsã•ã‚ŒãŸã‚·ãƒ³ãƒœãƒ«ã‚’ç¢ºèªã™ã‚‹ã«ã¯}

ns-xxx ã¨ã„ã†é–¢æ•°ã§èª¿ã¹ã‚‹.

-   ns-map
-   ns-publics
-   ns-interns
-   ns-refers
-   ns-imports

ãŸã¨ãˆã°, (ns-map 'my-space)ã§my-spaceã«bindingsã•ã‚Œã¦ã„ã‚‹varã‚’ã™ã¹ã¦è¿”ã™.

ns-mapã¯å…¨ã¦.
ns-publicsã¯publicãªvars.
ns-internsã¯requireã‚„referãªã©ã‚’é™¤ããã®namespaceã§å®šç¾©ã•ã‚ŒãŸã‚‚ã®.

ã—ã°ã—ã°, (keys (ns-interns 'my-space'))ãªã©, keys methodã¨é€£æºã•ã›ã‚‹.

M-x cider-browse-nsã§Emacs Bufferã§é–²è¦§ã§ãã‚‹.


## Clojure: å¤‰æ•°æŸç¸›(Bindings) {#clojure-å¤‰æ•°æŸç¸›--bindings}

-   å¤‰æ•°ã®åå‰ç©ºé–“ã¸ã®æŸç¸›ã‚’def
    -   list formã§bindingã™ã‚‹.
    -   ex.) (def developer "Alice")
    -   ç„¡åé–¢æ•°ã¯fn
-   å¤‰æ•°ã®ä¸€æ™‚çš„ãªæŸç¸›ã‚’ let
    -   vector formã§bindingã™ã‚‹.
    -   ex.) (let [developer "Alice in wonderland"])
-   é–¢æ•°ã®å®šç¾©ã¯defn
    -   ã“ã‚Œã¯defã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼ã§ã‚‚ã‚ã‚‹.
-   ç„¡åé–¢æ•°ã¯fn
    -   \#() ã§ã‚‚è¡¨ç¾å¯èƒ½.

[ğŸ·bindings]({{< relref "20220305075933.md#valuables-å¤‰æ•°" >}})


## Clojure: defã¨varã¨symbol {#clojure-defã¨varã¨symbol}


### Clojure: clojure.lang.Var {#clojure-clojure-dot-lang-dot-var}

-   clojure.lang.Varã¯ãƒ‡ãƒ¼ã‚¿ãã‚‚ã‚‚ã®ã‚’è¡¨ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ.
-   å¯å¤‰(mutable).
-   varã®ãƒªãƒ¼ãƒ€ãƒã‚¯ãƒ­ã¯, **#'**

varã«ã¯MetaDataã‚’è¨­å®šã§ãã‚‹. ã‚ˆãè¦‹ã‹ã‘ã‚‹ä»£è¡¨çš„ãªã®ã¯,

-   :dynamic
    -   åŒä¸€ã‚¹ãƒ¬ãƒƒãƒ‰å†…ã§å†å®šç¾©å¯èƒ½.
    -   (def ^:dynamic foo 1)
-   :private
    -   namespaceã‚’è¶…ãˆã¦å‚ç…§ä¸å¯.
    -   (def ^:private bar 2)

ref. [Clojure: MetaData]({{< relref "20220116162321.md#clojure-metadata" >}})


### Clojure: clojure.lang.Symbol {#clojure-clojure-dot-lang-dot-symbol}

-   clojure.lang.Symbolã¯ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡ã—ç¤ºã™å‚ç…§ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ.
-   symbolã®ãƒªãƒ¼ãƒ€ãƒã‚¯ãƒ­ã¯, **'** , ã‚‚ã—ãã¯ quoteã§èª­ã¿å‡ºã—.

cf. Cè¨€èªã®é–¢æ•°ã¨é–¢æ•°ãƒã‚¤ãƒ³ãƒˆãŒvarã¨symbolã®é–¢ä¿‚.


### Clojure: def macro / alter-var-rootã«ã‚ˆã‚‹varã®å†å®šç¾© {#clojure-def-macro-alter-var-rootã«ã‚ˆã‚‹varã®å†å®šç¾©}

**def** ãƒã‚¯ãƒ­ã¯, clojure.lang.Varã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹.

```clojure
user> (def x)
;; => #'user/x
user> x
;; => #object[clojure.lang.Var$Unbound 0x7d08131d "Unbound: #'user/x"]
```

defã«ã‚ˆã‚‹å¤‰æ•°æŸç¸›ã¯å†…éƒ¨ã§è¤‡é›‘ãªã“ã¨ã‚’ã—ã¦ã„ã‚‹.

```clojure
user=> (def foo "hoge")
#'user/foo
```

defãŒãƒã‚¯ãƒ­ã§ã‚ã‚‹ã¨ã¯,

1.  "hoge"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒ¡ãƒ¢ãƒªä¸Šã«ç¢ºä¿ã•ã‚Œã‚‹.(å®Ÿéš›ã®å€¤ã‚’0xhogohogehogeã¨ã—ã‚ˆã†).
2.  Varã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒ¡ãƒ¢ãƒªä¸Šã«ç¢ºä¿ã•ã‚Œã‚‹(0xvarvarvaaaaaaaaaaa).
3.  varã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’"hoge"ã«bind(0xvarvarvaaaaaaaaaaa -&gt; 0xhogohogehoge)ã™ã‚‹é–¢ä¿‚ã‚’ä½œæˆ.(0xbindbinddddddddddd)
4.  fooã¨ã„ã†symbolã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ(0xsymmmmmmmmmm)
5.  3ã®bindingã‚’symbolã«intern(0xsymmmmmmmm -&gt; 0xbindbinddddddd)ã¨ã„ã†é–¢ä¿‚ã‚’ä½œæˆã—ã¦namespaceã«bind.

varã¯mutableã§ã‚ã‚Šsymbolã¯immutable.

ã„ã‚ã‚†ã‚‹defã«ã‚ˆã£ã¦immutableãªå€¤ã‚’å®£è¨€ã™ã‚‹ã¨ã¯,
å‚ç…§å…ƒãŒimmutableã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã‚’è¨€ã£ã¦ã„ã‚‹.

defã«ã‚ˆã£ã¦varãŒå†å®šç¾©å¯èƒ½ã¨ã„ã†ã“ã¨ã¯,
defã¯symbolã‚’æ–°ã—ã„varã‚’ç”Ÿæˆã—ã¦bindingã—ã¦ã„ã‚‹.

ä¸€æ–¹alter-var-rooté–¢æ•°ã‚’ã¤ã‹ã†ã¨,
mutableã§ã‚ã‚‹varã‚’ãã®ã¾ã¾å¤‰æ›´ã™ã‚‹.

[Clojure Style Guide]({{< relref "20220313110515.md#clojure-ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰" >}}) ã§ã¯ varã®å¤‰æ›´ã«alter-var-rootæ¨å¥¨ã—ã¦ã„ã‚‹.

<https://totakke.github.io/clojure-style-guide/#alter-var>

ã—ã‹ã—ãã‚‚ãã‚‚è«–ã¨ã—ã¦, defã‚„alter-var-rootã«ã‚ˆã‚‹varã®å†å®šç¾©ã¯
REPLã‚„reloadã®ãŸã‚ã®ã‚‚ã®,ã„ã‚ã°é–‹ç™ºç”¨ã®ã‚‚ã®.
æ™®é€šã«ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã—ã¦ã„ã‚‹ã¨ãã«ã“ã‚ŒãŒå¿…è¦ã¨ãªã£ãŸã‚‰ä½•ã‹ãŒãŠã‹ã—ã„.
åˆ¥ã®ä»£æ›¿æ–¹æ³•ã‚’æ¤œè¨ã—ãŸã»ã†ãŒã„ã„.


### Clojure: intern {#clojure-intern}

defã¨ä¼¼ãŸæ¦‚å¿µã§intern(æ‹˜ç¦)ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹.

[def ã¨ Symbol ã¨ Var ã®è©± - (-&gt; % read write unlearn)](https://hatappo.hatenadiary.jp/entry/2016/08/27/010000)

defã§bindã—ãŸsymbol-varã®å¯¾å¿œé–¢ä¿‚ã‚’namespaceã«ç™»éŒ²ã™ã‚‹.


### Clojure: defonce {#clojure-defonce}

defã‚‚defonceã‚‚åå‰ç©ºé–“ã«å¤‰æ•°æŸç¸›ã‚’ã™ã‚‹ãŒ,
ã™ã§ã«varãŒå­˜åœ¨ã™ã‚‹å ´åˆ, defã¯ä¸Šæ›¸ã, defonceã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹.

è¨€ã„æ›ãˆã‚‹ã¨, var-symbolã®pairã‚’namespaceã«ç™»éŒ²ã™ã‚‹ã¨ãã«,
defonceã¯ã™ã§ã«var-symbolã®pairãŒã‚ã£ãŸã‚‰ãªã«ã‚‚ã—ãªã„.

ref: [What is the difference between def and defonce in Clojure? - Stack Overflow](https://stackoverflow.com/questions/37346984/what-is-the-difference-between-def-and-defonce-in-clojure)


#### defonceã¨atomã¨hotreload {#defonceã¨atomã¨hotreload}

defonceã¯hotreloadã®æ–‡è„ˆã§atomã¨åˆã‚ã›ã¦ç™»å ´ã™ã‚‹ã“ã¨ãŒå¤šã„.

å†èµ·å‹•ã®ã¨ãã«ãƒ¡ãƒ¢ãƒªã‚’ãŸãã•ã‚“ä½¿ã£ãŸã‚Šå¤–éƒ¨é€šä¿¡ã—ã¦æ™‚é–“ãŒã‹ã‹ã£ãŸã‚Šã™ã‚‹ã¨ãã«,
ã„ã¡ã„ã¡ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å†ä½œæˆã—ã¦ã‚‹ã¨ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚‹ã®ã§defonceã‚’ã¤ã‹ã†.

ãŸã ã—replã®å†èµ·å‹•ã§ã‚ˆãåˆ©ç”¨ã•ã‚Œã‚‹ tools.namespace.replã®refreshé–¢æ•°ã¯,
ãŸã¨ãˆdefonceã§å®šç¾©ã•ã‚Œã¦ã„ãŸã¨ã—ã¦ã‚‚åˆæœŸåŒ–ã™ã‚‹ã®ã§æ³¨æ„.

ref: <https://github.com/clojure/tools.namespace#reloading-code-preparing-your-application>

ãŸã¨ãˆã°M-x cider-eval-bufferã‚’ã†ã£ã‹ã‚ŠEmacsã§å®Ÿè¡Œã—ã¦ãƒãƒƒãƒ•ã‚¡ã¾ã‚‹ã”ã¨èª­ã¿è¾¼ã¿ç›´ã—ã¦ã‚‚,
defonceã§å®£è¨€ã—ã¦ã„ã‚‹ãªã‚‰ã°ãã®å¤‰æ•°æŸç¸›ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹.

ã¾ã‚ã“ã®ã‚ãŸã‚Šã®hotreloadã«ã‚ˆã‚‹DXæ”¹å–„ã¯è‡ªåˆ†ã§è€ƒãˆã‚‹ã‚ˆã‚Šã‚‚ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’çœŸä¼¼ã‚‹ã®ãŒã„ã„ã®ã‹ã‚‚.

ref: [Reloaded Workflow]({{< relref "20220117205249.md#reloaded-workflow" >}})


### References {#references}

-   [def ã¨ Symbol ã¨ Var ã®è©± - (-&gt; % read write unlearn)](https://hatappo.hatenadiary.jp/entry/2016/08/27/010000)
    -   <https://togetter.com/li/680027>
-   [Clojure ã® alter-var-root ã£ã¦ä½•ã ã‚ã†ï¼Ÿ - Mitsuyuki.Shiiba](https://bufferings.hatenablog.com/entry/2022/01/03/010101)


## âœ… Active Recalls {#active-recalls}


### Clojure ã® ç„¡åé–¢æ•°ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã¯ãªã‚“ã§ã™ã‹ï¼Ÿ {#clojure-ã®-ç„¡åé–¢æ•°ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã¯ãªã‚“ã§ã™ã‹}

fn or #()


### Clojureã®åå‰ç©ºé–“ã®å®£è¨€æ–¹æ³•ã¨å‚ç…§æ–¹æ³•ã¯ãªã‚“ã§ã™ã‹? {#clojureã®åå‰ç©ºé–“ã®å®£è¨€æ–¹æ³•ã¨å‚ç…§æ–¹æ³•ã¯ãªã‚“ã§ã™ã‹}

ns ã¨ \\\*ns\*


### Clojureã§åå‰ç©ºé–“ã‚’å‚ç…§ã™ã‚‹ãŸã‚ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã¯ãªã‚“ã§ã™ã‹? {#clojureã§åå‰ç©ºé–“ã‚’å‚ç…§ã™ã‚‹ãŸã‚ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã¯ãªã‚“ã§ã™ã‹}

require


### Clojure nsã®å±æ€§ã§ :requireã¨:importã®é•ã„ã¯ãªã‚“ã§ã™ã‹ï¼Ÿ {#clojure-nsã®å±æ€§ã§-requireã¨-importã®é•ã„ã¯ãªã‚“ã§ã™ã‹}

ã©ã¡ã‚‰ã‚‚namespaceã«ä»–ã®namespaceã§å®šç¾©ã•ã‚ŒãŸå®£è¨€ã‚’å–ã‚Šè¾¼ã‚€ãŒ,
requireã¯clojureã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª, importã¯Javaã®ã‚¯ãƒ©ã‚¹ã§åˆ©ç”¨ã™ã‚‹.


### Clojureã§defã¨defonceã®é•ã„ã¯ãªã‚“ã§ã™ã‹ï¼Ÿ {#clojureã§defã¨defonceã®é•ã„ã¯ãªã‚“ã§ã™ã‹}

åå‰ç©ºé–“ã«å¤‰æ•°æŸç¸›ã™ã‚‹ã¨ã,ã™ã§ã«å¤‰æ•°ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®æŒ™å‹•ãŒé•ã†.

defã¯ä¸Šæ›¸ãã‚’ã™ã‚‹. defonceã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹.


### Clojure.lang.Varã¨Symbolã®é•ã„ã¯ãªã‚“ã§ã™ã‹ï¼Ÿ {#clojure-dot-lang-dot-varã¨symbolã®é•ã„ã¯ãªã‚“ã§ã™ã‹}

Varã¯ãƒ‡ãƒ¼ã‚¿ã‚‚ãã®ã‚‚ã®ã‚’ç¤ºã™å‚ç…§.

Symbolã¯Varã‚’ç¤ºã™å‚ç…§.


### Clojure defã¨internã®é•ã„ã¯ãªã‚“ã§ã™ã‹ï¼Ÿ {#clojure-defã¨internã®é•ã„ã¯ãªã‚“ã§ã™ã‹}

defã¯å€¤ã¨å‚ç…§ã®å¯¾å¿œé–¢ä¿‚ã‚’ä½œæˆã—ã¦ãã®å¯¾å¿œé–¢ä¿‚ã‚’namespaceã«ç™»éŒ²ã™ã‚‹ã¾ã§ã®ä¸€é€£ã®æ‰‹ç¶šãã‚’ãƒã‚¯ãƒ­ã«ã—ãŸ.

internã¯æ‹˜ç¦ã§ã‚ã‚Šbindã•ã‚ŒãŸå†™åƒã‚’namespaceã«ç™»éŒ²ã™ã‚‹.
